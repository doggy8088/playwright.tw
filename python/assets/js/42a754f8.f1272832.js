"use strict";(self.webpackChunkplaywright_dev=self.webpackChunkplaywright_dev||[]).push([[8164],{4733:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>c,default:()=>x,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var o=t(4848),a=t(8453),s=t(4235),r=t(8328);t(3078);const i={id:"chrome-extensions",title:"Chrome \u64f4\u5145\u529f\u80fd"},c=void 0,l={id:"chrome-extensions",title:"Chrome \u64f4\u5145\u529f\u80fd",description:"\u7c21\u4ecb",source:"@site/versioned_docs/version-stable/chrome-extensions.mdx",sourceDirName:".",slug:"/chrome-extensions",permalink:"/python/docs/chrome-extensions",draft:!1,unlisted:!1,tags:[],version:"stable",frontMatter:{id:"chrome-extensions",title:"Chrome \u64f4\u5145\u529f\u80fd"},sidebar:"docs",previous:{title:"\u700f\u89bd\u5668",permalink:"/python/docs/browsers"},next:{title:"\u6642\u9418",permalink:"/python/docs/clock"}},p={},d=[{value:"\u7c21\u4ecb",id:"\u7c21\u4ecb",level:2},{value:"\u6e2c\u8a66",id:"\u6e2c\u8a66",level:2},{value:"\u7121\u982d\u6a21\u5f0f",id:"\u7121\u982d\u6a21\u5f0f",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"\u7c21\u4ecb",children:"\u7c21\u4ecb"}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsx)(n.p,{children:"\u64f4\u5145\u529f\u80fd\u50c5\u5728\u4f7f\u7528\u6301\u4e45\u6027\u4e0a\u4e0b\u6587\u555f\u52d5\u7684 Chrome / Chromium \u4e2d\u5de5\u4f5c\u3002\u4f7f\u7528\u81ea\u8a02\u700f\u89bd\u5668\u53c3\u6578\u9700\u81ea\u884c\u627f\u64d4\u98a8\u96aa\uff0c\u56e0\u70ba\u5176\u4e2d\u4e00\u4e9b\u53ef\u80fd\u6703\u7834\u58de Playwright \u529f\u80fd\u3002"})}),"\n",(0,o.jsxs)(n.p,{children:["\u4ee5\u4e0b\u662f\u53d6\u5f97 ",(0,o.jsx)(n.a,{href:"https://developer.chrome.com/extensions/background_pages",children:"background page"})," \u7684\u7a0b\u5f0f\u78bc\uff0c\u9019\u500b ",(0,o.jsx)(n.a,{href:"https://developer.chrome.com/docs/extensions/mv2/",children:"Manifest v2"})," \u64f4\u5145\u5957\u4ef6\u7684\u4f86\u6e90\u4f4d\u65bc ",(0,o.jsx)(n.code,{children:"./my-extension"}),"\uff1a"]}),"\n",(0,o.jsxs)(s.A,{groupId:"python-flavor",defaultValue:"sync",values:[{label:"Sync",value:"sync"},{label:"Async",value:"async"}],children:[(0,o.jsx)(r.A,{value:"sync",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-py",children:'from playwright.sync_api import sync_playwright, Playwright\n\npath_to_extension = "./my-extension"\nuser_data_dir = "/tmp/test-user-data-dir"\n\n\ndef run(playwright: Playwright):\n    context = playwright.chromium.launch_persistent_context(\n        user_data_dir,\n        headless=False,\n        args=[\n            f"--disable-extensions-except={path_to_extension}",\n            f"--load-extension={path_to_extension}",\n        ],\n    )\n    if len(context.background_pages) == 0:\n        background_page = context.wait_for_event(\'backgroundpage\')\n    else:\n        background_page = context.background_pages[0]\n\n    # Test the background page as you would any other page.\n    context.close()\n\n\nwith sync_playwright() as playwright:\n    run(playwright)\n'})})}),(0,o.jsx)(r.A,{value:"async",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-py",children:'import asyncio\nfrom playwright.async_api import async_playwright, Playwright\n\npath_to_extension = "./my-extension"\nuser_data_dir = "/tmp/test-user-data-dir"\n\n\nasync def run(playwright: Playwright):\n    context = await playwright.chromium.launch_persistent_context(\n        user_data_dir,\n        headless=False,\n        args=[\n            f"--disable-extensions-except={path_to_extension}",\n            f"--load-extension={path_to_extension}",\n        ],\n    )\n\n    if len(context.background_pages) == 0:\n        background_page = await context.wait_for_event(\'backgroundpage\')\n    else:\n        background_page = context.background_pages[0]\n\n    # Test the background page as you would any other page.\n    await context.close()\n\n\nasync def main():\n    async with async_playwright() as playwright:\n        await run(playwright)\n\n\nasyncio.run(main())\n'})})})]}),"\n",(0,o.jsx)(n.h2,{id:"\u6e2c\u8a66",children:"\u6e2c\u8a66"}),"\n",(0,o.jsx)(n.p,{children:"\u70ba\u4e86\u5728\u57f7\u884c\u6e2c\u8a66\u6642\u8f09\u5165\u64f4\u5145\u529f\u80fd\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u6e2c\u8a66\u88dd\u7f6e\u4f86\u8a2d\u5b9a\u4e0a\u4e0b\u6587\u3002\u60a8\u4e5f\u53ef\u4ee5\u52d5\u614b\u6aa2\u7d22\u64f4\u5145\u529f\u80fd ID\uff0c\u4e26\u4f7f\u7528\u5b83\u4f86\u8f09\u5165\u548c\u6e2c\u8a66\u5f48\u51fa\u9801\u9762\u7bc4\u4f8b\u3002"}),"\n",(0,o.jsx)(n.p,{children:"\u9996\u5148\uff0c\u65b0\u589e\u5c07\u8f09\u5165\u64f4\u5145\u529f\u80fd\u7684\u56fa\u5b9a\u88dd\u7f6e:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",metastring:'title="conftest.py"',children:'from typing import Generator\nfrom pathlib import Path\nfrom playwright.sync_api import Playwright, BrowserContext\nimport pytest\n\n\n@pytest.fixture()\ndef context(playwright: Playwright) -> Generator[BrowserContext, None, None]:\n    path_to_extension = Path(__file__).parent.joinpath("my-extension")\n    context = playwright.chromium.launch_persistent_context(\n        "",\n        headless=False,\n        args=[\n            f"--disable-extensions-except={path_to_extension}",\n            f"--load-extension={path_to_extension}",\n        ],\n    )\n    yield context\n    context.close()\n\n\n@pytest.fixture()\ndef extension_id(context) -> Generator[str, None, None]:\n    # for manifest v2:\n    # background = context.background_pages[0]\n    # if not background:\n    #     background = context.wait_for_event("backgroundpage")\n\n    # for manifest v3:\n    background = context.service_workers[0]\n    if not background:\n        background = context.wait_for_event("serviceworker")\n\n    extension_id = background.url.split("/")[2]\n    yield extension_id\n\n'})}),"\n",(0,o.jsx)(n.p,{children:"\u7136\u5f8c\u5728\u6e2c\u8a66\u4e2d\u4f7f\u7528\u9019\u4e9b\u88dd\u7f6e:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",metastring:'title="test_foo.py"',children:'from playwright.sync_api import expect, Page\n\n\ndef test_example_test(page: Page) -> None:\n    page.goto("https://example.com")\n    expect(page.locator("body")).to_contain_text("Changed by my-extension")\n\n\ndef test_popup_page(page: Page, extension_id: str) -> None:\n    page.goto(f"chrome-extension://{extension_id}/popup.html")\n    expect(page.locator("body")).to_have_text("my-extension popup")\n'})}),"\n",(0,o.jsx)(n.h2,{id:"\u7121\u982d\u6a21\u5f0f",children:"\u7121\u982d\u6a21\u5f0f"}),"\n",(0,o.jsx)(n.admonition,{type:"danger",children:(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"headless=new"})," \u6a21\u5f0f\u4e0d\u53d7 Playwright \u5b98\u65b9\u652f\u6301\uff0c\u53ef\u80fd\u6703\u5c0e\u81f4\u610f\u5916\u884c\u70ba\u3002"]})}),"\n",(0,o.jsx)(n.p,{children:"\u9810\u8a2d\u60c5\u6cc1\u4e0b\uff0cChrome \u5728 Playwright \u4e2d\u7684\u7121\u982d\u6a21\u5f0f\u4e0d\u652f\u63f4 Chrome \u64f4\u5145\u529f\u80fd\u3002\u70ba\u4e86\u514b\u670d\u9019\u4e00\u9650\u5236\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u7a0b\u5f0f\u78bc\u5728\u65b0\u7684\u7121\u982d\u6a21\u5f0f\u4e0b\u57f7\u884c Chrome \u7684\u6301\u4e45\u6027\u4e0a\u4e0b\u6587:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",metastring:'title="conftest.py"',children:'path_to_extension = Path(__file__).parent.joinpath("my-extension")\ncontext = playwright.chromium.launch_persistent_context(\n    "",\n    headless=False,\n    args=[\n        "--headless=new",\n        f"--disable-extensions-except={path_to_extension}",\n        f"--load-extension={path_to_extension}",\n    ],\n)\n'})})]})}function x(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}}}]);