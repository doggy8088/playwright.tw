"use strict";(self.webpackChunkplaywright_dev=self.webpackChunkplaywright_dev||[]).push([[5615],{2815:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>d,toc:()=>l});var i=t(4848),r=t(8453),s=t(4235),o=t(8328);t(3078);const c={id:"webview2",title:"WebView2"},a=void 0,d={id:"webview2",title:"WebView2",description:"\u7c21\u4ecb",source:"@site/versioned_docs/version-stable/webview2.mdx",sourceDirName:".",slug:"/webview2",permalink:"/python/docs/webview2",draft:!1,unlisted:!1,tags:[],version:"stable",frontMatter:{id:"webview2",title:"WebView2"},sidebar:"docs",previous:{title:"\u9304\u5f71",permalink:"/python/docs/videos"},next:{title:"Docker",permalink:"/python/docs/docker"}},p={},l=[{value:"\u7c21\u4ecb",id:"\u7c21\u4ecb",level:2},{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:2},{value:"Writing and running tests",id:"writing-and-running-tests",level:2},{value:"\u9664\u932f",id:"\u9664\u932f",level:2}];function w(e){const n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"\u7c21\u4ecb",children:"\u7c21\u4ecb"}),"\n",(0,i.jsxs)(n.p,{children:["\u4ee5\u4e0b\u5c07\u8aaa\u660e\u5982\u4f55\u5c07 Playwright \u8207 ",(0,i.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/microsoft-edge/webview2",children:"Microsoft Edge WebView2"})," \u4e00\u8d77\u4f7f\u7528\u3002WebView2 \u662f\u4e00\u500b WinForms \u63a7\u5236\u9805\uff0c\u5b83\u5c07\u4f7f\u7528 Microsoft Edge \u5728\u5f8c\u7aef\u6e32\u67d3\u7db2\u9801\u5167\u5bb9\u3002\u5b83\u662f Microsoft Edge \u700f\u89bd\u5668\u7684\u4e00\u90e8\u5206\uff0c\u53ef\u5728 Windows 10 \u548c Windows 11 \u4e0a\u4f7f\u7528\u3002Playwright \u53ef\u7528\u65bc\u81ea\u52d5\u5316 WebView2 \u61c9\u7528\u7a0b\u5f0f\uff0c\u4e26\u53ef\u7528\u65bc\u6e2c\u8a66 WebView2 \u4e2d\u7684\u7db2\u9801\u5167\u5bb9\u3002\u70ba\u4e86\u9023\u63a5\u5230 WebView2\uff0cPlaywright \u4f7f\u7528 ",(0,i.jsx)(n.a,{href:"/python/docs/api/class-browsertype#browser-type-connect-over-cdp",children:"browser_type.connect_over_cdp"}),"\uff0c\u5b83\u901a\u904e Chrome DevTools Protocol (CDP) \u9023\u63a5\u5230 WebView2\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"\u6982\u8ff0",children:"\u6982\u8ff0"}),"\n",(0,i.jsxs)(n.p,{children:["WebView2 \u63a7\u5236\u9805\u53ef\u4ee5\u900f\u904e\u8a2d\u5b9a ",(0,i.jsx)(n.code,{children:"WEBVIEW2_ADDITIONAL_BROWSER_ARGUMENTS"})," \u74b0\u5883\u8b8a\u6578\u70ba ",(0,i.jsx)(n.code,{children:"--remote-debugging-port=9222"})," \u6216\u547c\u53eb ",(0,i.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/dotnet/api/microsoft.web.webview2.wpf.webview2.ensurecorewebview2async?view=webview2-dotnet-1.0.1343.22",children:"EnsureCoreWebView2Async"})," \u4e26\u5e36\u4e0a ",(0,i.jsx)(n.code,{children:"--remote-debugging-port=9222"})," \u53c3\u6578\u4f86\u6307\u793a\u5176\u76e3\u807d\u9032\u5165\u7684 CDP \u9023\u63a5\u3002\u9019\u5c07\u555f\u52d5\u555f\u7528 Chrome DevTools Protocol \u7684 WebView2 \u7a0b\u5e8f\uff0c\u5141\u8a31 Playwright \u9032\u884c\u81ea\u52d5\u5316\u30029222 \u662f\u6b64\u7bc4\u4f8b\u4e2d\u7684\u57e0\u865f\uff0c\u4f46\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u5176\u4ed6\u672a\u4f7f\u7528\u7684\u57e0\u865f\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'await this.webView.EnsureCoreWebView2Async(await CoreWebView2Environment.CreateAsync(null, null, new CoreWebView2EnvironmentOptions()\n{\n  AdditionalBrowserArguments = "--remote-debugging-port=9222",\n})).ConfigureAwait(false);\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u4e00\u65e6\u5305\u542b WebView2 \u63a7\u5236\u9805\u7684\u61c9\u7528\u7a0b\u5f0f\u6b63\u5728\u57f7\u884c\uff0c\u4f60\u53ef\u4ee5\u901a\u904e Playwright \u9023\u63a5\u5230\u5b83:"}),"\n",(0,i.jsxs)(s.A,{groupId:"python-flavor",defaultValue:"sync",values:[{label:"Sync",value:"sync"},{label:"Async",value:"async"}],children:[(0,i.jsx)(o.A,{value:"sync",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-py",children:'browser = playwright.chromium.connect_over_cdp("http://localhost:9222")\ncontext = browser.contexts[0]\npage = context.pages[0]\n'})})}),(0,i.jsx)(o.A,{value:"async",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-py",children:'browser = await playwright.chromium.connect_over_cdp("http://localhost:9222")\ncontext = browser.contexts[0]\npage = context.pages[0]\n'})})})]}),"\n",(0,i.jsxs)(n.p,{children:["\u70ba\u4e86\u78ba\u4fdd WebView2 \u63a7\u5236\u9805\u5df2\u6e96\u5099\u597d\uff0c\u4f60\u53ef\u4ee5\u7b49\u5f85 ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/dotnet/api/microsoft.web.webview2.wpf.webview2.corewebview2initializationcompleted?view=webview2-dotnet-1.0.1343.22",children:(0,i.jsx)(n.code,{children:"CoreWebView2InitializationCompleted"})})," \u4e8b\u4ef6\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'this.webView.CoreWebView2InitializationCompleted += (_, e) =>\n{\n    if (e.IsSuccess)\n    {\n        Console.WriteLine("WebView2 initialized");\n    }\n};\n'})}),"\n",(0,i.jsx)(n.h2,{id:"writing-and-running-tests",children:"Writing and running tests"}),"\n",(0,i.jsxs)(n.p,{children:["\u9810\u8a2d\u60c5\u6cc1\u4e0b\uff0cWebView2 \u63a7\u5236\u9805\u5c07\u5c0d\u6240\u6709\u5be6\u4f8b\u4f7f\u7528\u76f8\u540c\u7684\u7528\u6236\u8cc7\u6599\u76ee\u9304\u3002\u9019\u610f\u5473\u8457\u5982\u679c\u60a8\u5e73\u884c\u57f7\u884c\u591a\u500b\u6e2c\u8a66\uff0c\u5b83\u5011\u5c07\u4e92\u76f8\u5e72\u64fe\u3002\u70ba\u4e86\u907f\u514d\u9019\u7a2e\u60c5\u6cc1\uff0c\u60a8\u61c9\u8a72\u70ba\u6bcf\u500b\u6e2c\u8a66\u8a2d\u7f6e ",(0,i.jsx)(n.code,{children:"WEBVIEW2_USER_DATA_FOLDER"})," \u74b0\u5883\u8b8a\u6578\uff08\u6216\u4f7f\u7528 ",(0,i.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/dotnet/api/microsoft.web.webview2.wpf.webview2.ensurecorewebview2async?view=webview2-dotnet-1.0.1343.22",children:"WebView2.EnsureCoreWebView2Async Method"}),"\uff09\uff0c\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u6587\u4ef6\u593e\u3002\u9019\u5c07\u78ba\u4fdd\u6bcf\u500b\u6e2c\u8a66\u5728\u5176\u81ea\u5df1\u7684\u7528\u6236\u8cc7\u6599\u76ee\u9304\u4e2d\u57f7\u884c\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u4f7f\u7528\u4ee5\u4e0b\u5167\u5bb9\uff0cPlaywright \u5c07\u6703\u5c07\u4f60\u7684 WebView2 \u61c9\u7528\u7a0b\u5f0f\u4f5c\u70ba\u5b50\u7a0b\u5e8f\u57f7\u884c\uff0c\u70ba\u5176\u5206\u914d\u4e00\u500b\u552f\u4e00\u7684\u4f7f\u7528\u8005\u8cc7\u6599\u76ee\u9304\uff0c\u4e26\u5c07 ",(0,i.jsx)(n.a,{href:"/python/docs/api/class-page",children:"Page"})," \u5be6\u4f8b\u63d0\u4f9b\u7d66\u4f60\u7684\u6e2c\u8a66\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="conftest.py"',children:'import os\nimport socket\nimport tempfile\nimport pytest\nfrom pathlib import Path\nfrom playwright.sync_api import Playwright, Browser, BrowserContext\nimport subprocess\n\nEXECUTABLE_PATH = (\n    Path(__file__).parent\n    / ".."\n    / "webview2-app"\n    / "bin"\n    / "Debug"\n    / "net8.0-windows"\n    / "webview2.exe"\n)\n\n\n@pytest.fixture(scope="session")\ndef data_dir():\n    with tempfile.TemporaryDirectory(\n        prefix="playwright-webview2-tests", ignore_cleanup_errors=True\n    ) as tmpdirname:\n        yield tmpdirname\n\n\n@pytest.fixture(scope="session")\ndef webview2_process_cdp_port(data_dir: str):\n    cdp_port = _find_free_port()\n    process = subprocess.Popen(\n        [EXECUTABLE_PATH],\n        env={\n            **dict(os.environ),\n            "WEBVIEW2_ADDITIONAL_BROWSER_ARGUMENTS": f"--remote-debugging-port={cdp_port}",\n            "WEBVIEW2_USER_DATA_FOLDER": data_dir,\n        },\n        stdout=subprocess.PIPE,\n        stderr=subprocess.STDOUT,\n        universal_newlines=True,\n    )\n    while True:\n        line = process.stdout.readline()\n        if "WebView2 initialized" in line:\n            break\n    yield cdp_port\n    process.terminate()\n\n\n@pytest.fixture(scope="session")\ndef browser(playwright: Playwright, webview2_process_cdp_port: int):\n    browser = playwright.chromium.connect_over_cdp(\n        f"http://127.0.0.1:{webview2_process_cdp_port}"\n    )\n    yield browser\n\n\n@pytest.fixture(scope="function")\ndef context(browser: Browser):\n    context = browser.contexts[0]\n    yield context\n\n\n@pytest.fixture(scope="function")\ndef page(context: BrowserContext):\n    page = context.pages[0]\n    yield page\n\n\ndef _find_free_port(port=9000, max_port=65535):\n    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    while port <= max_port:\n        try:\n            sock.bind(("", port))\n            sock.close()\n            return port\n        except OSError:\n            port += 1\n    raise IOError("no free ports")\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="test_webview2.py"',children:'from playwright.sync_api import Page, expect\n\n\ndef test_webview2(page: Page):\n    page.goto("https://playwright.dev")\n    get_started = page.get_by_text("Get Started")\n    expect(get_started).to_be_visible()\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u9664\u932f",children:"\u9664\u932f"}),"\n",(0,i.jsxs)(n.p,{children:['\u5728\u4f60\u7684 webview2 \u63a7\u5236\u9805\u5167\uff0c\u4f60\u53ef\u4ee5\u53f3\u9375\u9ede\u64ca\u4ee5\u6253\u958b\u4e0a\u4e0b\u6587\u9078\u55ae\u4e26\u9078\u64c7 "Inspect" \u4f86\u6253\u958b DevTools \u6216\u6309 ',(0,i.jsx)("kbd",{children:"F12"}),"\u3002\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/dotnet/api/microsoft.web.webview2.core.corewebview2.opendevtoolswindow?view=webview2-dotnet-1.0.1462.37",children:"WebView2.CoreWebView2.OpenDevToolsWindow"})," \u65b9\u6cd5\u4ee5\u7a0b\u5f0f\u78bc\u65b9\u5f0f\u6253\u958b DevTools\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u5982\u9700\u9664\u932f\u6e2c\u8a66\uff0c\u8acb\u53c3\u95b1 Playwright ",(0,i.jsx)(n.a,{href:"./debug",children:"\u9664\u932f\u6307\u5357"}),"\u3002"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(w,{...e})}):w(e)}}}]);