"use strict";(self.webpackChunkplaywright_dev=self.webpackChunkplaywright_dev||[]).push([[6],{9945:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>l,toc:()=>p});var i=t(4848),o=t(8453),r=t(4235),s=t(8328);t(3078);const c={id:"webview2",title:"WebView2"},a=void 0,l={id:"webview2",title:"WebView2",description:"Introduction",source:"@site/docs/webview2.mdx",sourceDirName:".",slug:"/webview2",permalink:"/python/docs/next/webview2",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"webview2",title:"WebView2"},sidebar:"docs",previous:{title:"Videos",permalink:"/python/docs/next/videos"},next:{title:"Docker",permalink:"/python/docs/next/docker"}},d={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Overview",id:"overview",level:2},{value:"Writing and running tests",id:"writing-and-running-tests",level:2},{value:"Debugging",id:"debugging",level:2}];function w(e){const n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(n.p,{children:["The following will explain how to use Playwright with ",(0,i.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/microsoft-edge/webview2/",children:"Microsoft Edge WebView2"}),". WebView2 is a WinForms control, which will use Microsoft Edge under the hood to render web content. It is a part of the Microsoft Edge browser and is available on Windows 10 and Windows 11. Playwright can be used to automate WebView2 applications and can be used to test web content in WebView2. For connecting to WebView2, Playwright uses ",(0,i.jsx)(n.a,{href:"/python/docs/next/api/class-browsertype#browser-type-connect-over-cdp",children:"browser_type.connect_over_cdp()"})," which connects to it via the Chrome DevTools Protocol (CDP)."]}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["A WebView2 control can be instructed to listen to incoming CDP connections by setting either the ",(0,i.jsx)(n.code,{children:"WEBVIEW2_ADDITIONAL_BROWSER_ARGUMENTS"})," environment variable with ",(0,i.jsx)(n.code,{children:"--remote-debugging-port=9222"})," or calling ",(0,i.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/dotnet/api/microsoft.web.webview2.wpf.webview2.ensurecorewebview2async?view=webview2-dotnet-1.0.1343.22",children:"EnsureCoreWebView2Async"})," with the ",(0,i.jsx)(n.code,{children:"--remote-debugging-port=9222"})," argument. This will start the WebView2 process with the Chrome DevTools Protocol enabled which allows the automation by Playwright. 9222 is an example port in this case, but any other unused port can be used as well."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'await this.webView.EnsureCoreWebView2Async(await CoreWebView2Environment.CreateAsync(null, null, new CoreWebView2EnvironmentOptions()\n{\n  AdditionalBrowserArguments = "--remote-debugging-port=9222",\n})).ConfigureAwait(false);\n'})}),"\n",(0,i.jsx)(n.p,{children:"Once your application with the WebView2 control is running, you can connect to it via Playwright:"}),"\n",(0,i.jsxs)(r.A,{groupId:"python-flavor",defaultValue:"sync",values:[{label:"Sync",value:"sync"},{label:"Async",value:"async"}],children:[(0,i.jsx)(s.A,{value:"sync",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-py",children:'browser = playwright.chromium.connect_over_cdp("http://localhost:9222")\ncontext = browser.contexts[0]\npage = context.pages[0]\n'})})}),(0,i.jsx)(s.A,{value:"async",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-py",children:'browser = await playwright.chromium.connect_over_cdp("http://localhost:9222")\ncontext = browser.contexts[0]\npage = context.pages[0]\n'})})})]}),"\n",(0,i.jsxs)(n.p,{children:["To ensure that the WebView2 control is ready, you can wait for the ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/dotnet/api/microsoft.web.webview2.wpf.webview2.corewebview2initializationcompleted?view=webview2-dotnet-1.0.1343.22",children:(0,i.jsx)(n.code,{children:"CoreWebView2InitializationCompleted"})})," event:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'this.webView.CoreWebView2InitializationCompleted += (_, e) =>\n{\n    if (e.IsSuccess)\n    {\n        Console.WriteLine("WebView2 initialized");\n    }\n};\n'})}),"\n",(0,i.jsx)(n.h2,{id:"writing-and-running-tests",children:"Writing and running tests"}),"\n",(0,i.jsxs)(n.p,{children:["By default, the WebView2 control will use the same user data directory for all instances. This means that if you run multiple tests in parallel, they will interfere with each other. To avoid this, you should set the ",(0,i.jsx)(n.code,{children:"WEBVIEW2_USER_DATA_FOLDER"})," environment variable (or use ",(0,i.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/dotnet/api/microsoft.web.webview2.wpf.webview2.ensurecorewebview2async?view=webview2-dotnet-1.0.1343.22",children:"WebView2.EnsureCoreWebView2Async Method"}),") to a different folder for each test. This will make sure that each test runs in its own user data directory."]}),"\n",(0,i.jsxs)(n.p,{children:["Using the following, Playwright will run your WebView2 application as a sub-process, assign a unique user data directory to it and provide the ",(0,i.jsx)(n.a,{href:"/python/docs/next/api/class-page",title:"Page",children:"Page"})," instance to your test:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="conftest.py"',children:'import os\nimport socket\nimport tempfile\nimport pytest\nfrom pathlib import Path\nfrom playwright.sync_api import Playwright, Browser, BrowserContext\nimport subprocess\n\nEXECUTABLE_PATH = (\n    Path(__file__).parent\n    / ".."\n    / "webview2-app"\n    / "bin"\n    / "Debug"\n    / "net8.0-windows"\n    / "webview2.exe"\n)\n\n\n@pytest.fixture(scope="session")\ndef data_dir():\n    with tempfile.TemporaryDirectory(\n        prefix="playwright-webview2-tests", ignore_cleanup_errors=True\n    ) as tmpdirname:\n        yield tmpdirname\n\n\n@pytest.fixture(scope="session")\ndef webview2_process_cdp_port(data_dir: str):\n    cdp_port = _find_free_port()\n    process = subprocess.Popen(\n        [EXECUTABLE_PATH],\n        env={\n            **dict(os.environ),\n            "WEBVIEW2_ADDITIONAL_BROWSER_ARGUMENTS": f"--remote-debugging-port={cdp_port}",\n            "WEBVIEW2_USER_DATA_FOLDER": data_dir,\n        },\n        stdout=subprocess.PIPE,\n        stderr=subprocess.STDOUT,\n        universal_newlines=True,\n    )\n    while True:\n        line = process.stdout.readline()\n        if "WebView2 initialized" in line:\n            break\n    yield cdp_port\n    process.terminate()\n\n\n@pytest.fixture(scope="session")\ndef browser(playwright: Playwright, webview2_process_cdp_port: int):\n    browser = playwright.chromium.connect_over_cdp(\n        f"http://127.0.0.1:{webview2_process_cdp_port}"\n    )\n    yield browser\n\n\n@pytest.fixture(scope="function")\ndef context(browser: Browser):\n    context = browser.contexts[0]\n    yield context\n\n\n@pytest.fixture(scope="function")\ndef page(context: BrowserContext):\n    page = context.pages[0]\n    yield page\n\n\ndef _find_free_port(port=9000, max_port=65535):\n    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    while port <= max_port:\n        try:\n            sock.bind(("", port))\n            sock.close()\n            return port\n        except OSError:\n            port += 1\n    raise IOError("no free ports")\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="test_webview2.py"',children:'from playwright.sync_api import Page, expect\n\n\ndef test_webview2(page: Page):\n    page.goto("https://playwright.dev")\n    get_started = page.get_by_text("Get Started")\n    expect(get_started).to_be_visible()\n'})}),"\n",(0,i.jsx)(n.h2,{id:"debugging",children:"Debugging"}),"\n",(0,i.jsxs)(n.p,{children:['Inside your webview2 control, you can just right-click to open the context menu and select "Inspect" to open the DevTools or press ',(0,i.jsx)("kbd",{children:"F12"}),". You can also use the ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/dotnet/api/microsoft.web.webview2.core.corewebview2.opendevtoolswindow?view=webview2-dotnet-1.0.1462.37",children:"WebView2.CoreWebView2.OpenDevToolsWindow"})," method to open the DevTools programmatically."]}),"\n",(0,i.jsxs)(n.p,{children:["For debugging tests, see the Playwright ",(0,i.jsx)(n.a,{href:"./debug",children:"Debugging guide"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(w,{...e})}):w(e)}}}]);