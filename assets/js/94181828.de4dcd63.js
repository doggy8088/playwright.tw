"use strict";(self.webpackChunkplaywright_dev=self.webpackChunkplaywright_dev||[]).push([[2246],{2030:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>c,contentTitle:()=>r,default:()=>o,frontMatter:()=>i,metadata:()=>l,toc:()=>h});var n=t(4848),a=t(8453);t(4235),t(8328),t(3078);const i={id:"test-snapshots",title:"\u8996\u89ba\u6bd4\u8f03"},r=void 0,l={id:"test-snapshots",title:"\u8996\u89ba\u6bd4\u8f03",description:"\u7c21\u4ecb",source:"@site/versioned_docs/version-stable/test-snapshots.mdx",sourceDirName:".",slug:"/test-snapshots",permalink:"/docs/test-snapshots",draft:!1,unlisted:!1,tags:[],version:"stable",frontMatter:{id:"test-snapshots",title:"\u8996\u89ba\u6bd4\u8f03"},sidebar:"docs",previous:{title:"\u622a\u5716",permalink:"/docs/screenshots"},next:{title:"\u6e2c\u8a66\u7522\u751f\u5668",permalink:"/docs/codegen"}},c={},h=[{value:"\u7c21\u4ecb",id:"\u7c21\u4ecb",level:2},{value:"\u7522\u751f\u622a\u5716",id:"\u7522\u751f\u622a\u5716",level:2},{value:"\u66f4\u65b0\u622a\u5716",id:"\u66f4\u65b0\u622a\u5716",level:2},{value:"\u9078\u9805",id:"\u9078\u9805",level:2},{value:"maxDiffPixels",id:"maxdiffpixels",level:3},{value:"stylePath",id:"stylepath",level:3},{value:"\u975e\u5f71\u50cf\u5feb\u7167",id:"\u975e\u5f71\u50cf\u5feb\u7167",level:2}];function p(e){const s={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h2,{id:"\u7c21\u4ecb",children:"\u7c21\u4ecb"}),"\n",(0,n.jsxs)(s.p,{children:["Playwright Test \u5305\u542b\u4f7f\u7528 ",(0,n.jsx)(s.code,{children:"await expect(page).toHaveScreenshot()"})," \u4f86\u751f\u6210\u548c\u8996\u89ba\u6bd4\u8f03\u622a\u5716\u7684\u529f\u80fd\u3002\u5728\u7b2c\u4e00\u6b21\u57f7\u884c\u6642\uff0cPlaywright Test \u6703\u751f\u6210\u53c3\u8003\u622a\u5716\u3002\u96a8\u5f8c\u7684\u57f7\u884c\u5c07\u8207\u53c3\u8003\u622a\u5716\u9032\u884c\u6bd4\u8f03\u3002"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-js",metastring:'title="example.spec.ts"',children:"import { test, expect } from '@playwright/test';\n\ntest('example test', async ({ page }) => {\n  await page.goto('https://playwright.dev');\n  await expect(page).toHaveScreenshot();\n});\n"})}),"\n",(0,n.jsx)(s.h2,{id:"\u7522\u751f\u622a\u5716",children:"\u7522\u751f\u622a\u5716"}),"\n",(0,n.jsx)(s.p,{children:"\u7576\u4f60\u7b2c\u4e00\u6b21\u57f7\u884c\u4e0a\u8ff0\u7a0b\u5f0f\u78bc\u6642\uff0c\u6e2c\u8a66\u57f7\u884c\u5668\u6703\u8aaa:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-txt",children:"Error: A snapshot doesn't exist at example.spec.ts-snapshots/example-test-1-chromium-darwin.png, writing actual.\n"})}),"\n",(0,n.jsx)(s.p,{children:"\u9019\u662f\u56e0\u70ba\u9084\u6c92\u6709\u9ec3\u91d1\u6a94\u6848\u3002\u6b64\u65b9\u6cd5\u62cd\u651d\u4e86\u4e00\u5806\u622a\u5716\uff0c\u76f4\u5230\u5169\u500b\u9023\u7e8c\u7684\u622a\u5716\u5339\u914d\uff0c\u4e26\u5c07\u6700\u5f8c\u4e00\u500b\u622a\u5716\u4fdd\u5b58\u5230\u6a94\u6848\u7cfb\u7d71\u3002\u5b83\u73fe\u5728\u6e96\u5099\u88ab\u6dfb\u52a0\u5230\u5b58\u5132\u5eab\u3002"}),"\n",(0,n.jsx)(s.p,{children:"\u6e2c\u8a66\u6a94\u6848\u540d\u7a31\u958b\u982d\u7684\u8cc7\u6599\u593e\u540d\u7a31\u5305\u542b\u9ec3\u91d1\u671f\u671b:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"drwxr-xr-x  5 user  group  160 Jun  4 11:46 .\ndrwxr-xr-x  6 user  group  192 Jun  4 11:45 ..\n-rw-r--r--  1 user  group  231 Jun  4 11:16 example.spec.ts\ndrwxr-xr-x  3 user  group   96 Jun  4 11:46 example.spec.ts-snapshots\n"})}),"\n",(0,n.jsxs)(s.p,{children:["\u5feb\u7167\u540d\u7a31 ",(0,n.jsx)(s.code,{children:"example-test-1-chromium-darwin.png"})," \u5305\u542b\u5e7e\u500b\u90e8\u5206:"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.code,{children:"example-test-1.png"})," - \u81ea\u52d5\u751f\u6210\u7684\u5feb\u7167\u540d\u7a31\u3002\u6216\u8005\uff0c\u60a8\u53ef\u4ee5\u5c07\u5feb\u7167\u540d\u7a31\u6307\u5b9a\u70ba ",(0,n.jsx)(s.code,{children:"toHaveScreenshot()"})," \u65b9\u6cd5\u7684\u7b2c\u4e00\u500b\u53c3\u6578:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-js",children:"await expect(page).toHaveScreenshot('landing.png');\n"})}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.code,{children:"chromium-darwin"})," - \u700f\u89bd\u5668\u540d\u7a31\u548c\u5e73\u53f0\u3002\u7531\u65bc\u4e0d\u540c\u7684\u6e32\u67d3\u3001\u5b57\u9ad4\u7b49\u539f\u56e0\uff0c\u700f\u89bd\u5668\u548c\u5e73\u53f0\u4e4b\u9593\u7684\u622a\u5716\u6703\u6709\u6240\u4e0d\u540c\uff0c\u56e0\u6b64\u60a8\u9700\u8981\u70ba\u5b83\u5011\u6e96\u5099\u4e0d\u540c\u7684\u5feb\u7167\u3002\u5982\u679c\u60a8\u5728 ",(0,n.jsx)(s.a,{href:"/docs/test-configuration",children:"configuration file"})," \u4e2d\u4f7f\u7528\u591a\u500b\u5c08\u6848\uff0c\u5c08\u6848\u540d\u7a31\u5c07\u53d6\u4ee3 ",(0,n.jsx)(s.code,{children:"chromium"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["\u5feb\u7167\u540d\u7a31\u548c\u8def\u5f91\u53ef\u4ee5\u5728 playwright \u914d\u7f6e\u4e2d\u4f7f\u7528 ",(0,n.jsx)(s.a,{href:"./api/class-testproject#test-project-snapshot-path-template",children:(0,n.jsx)(s.code,{children:"snapshotPathTemplate"})})," \u9032\u884c\u914d\u7f6e\u3002"]}),"\n",(0,n.jsx)(s.h2,{id:"\u66f4\u65b0\u622a\u5716",children:"\u66f4\u65b0\u622a\u5716"}),"\n",(0,n.jsxs)(s.p,{children:["\u6709\u6642\u5019\u4f60\u9700\u8981\u66f4\u65b0\u53c3\u8003\u622a\u5716\uff0c\u4f8b\u5982\u7576\u9801\u9762\u5df2\u7d93\u66f4\u6539\u6642\u3002\u4f7f\u7528 ",(0,n.jsx)(s.code,{children:"--update-snapshots"})," \u65d7\u6a19\u4f86\u5b8c\u6210\u9019\u500b\u64cd\u4f5c\u3002"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"npx playwright test --update-snapshots\n"})}),"\n",(0,n.jsxs)(s.blockquote,{children:["\n",(0,n.jsxs)(s.p,{children:["\u8acb\u6ce8\u610f\uff0c",(0,n.jsx)(s.code,{children:"snapshotName"})," \u4e5f\u63a5\u53d7\u5feb\u7167\u6a94\u6848\u8def\u5f91\u6bb5\u7684\u9663\u5217\uff0c\u4f8b\u5982 ",(0,n.jsx)(s.code,{children:"expect().toHaveScreenshot(['relative', 'path', 'to', 'snapshot.png'])"}),"\u3002\n\u4f46\u662f\uff0c\u6b64\u8def\u5f91\u5fc5\u9808\u4fdd\u7559\u5728\u6bcf\u500b\u6e2c\u8a66\u6a94\u6848\u7684\u5feb\u7167\u76ee\u9304\u5167 (\u5373 ",(0,n.jsx)(s.code,{children:"a.spec.js-snapshots"}),")\uff0c\u5426\u5247\u6703\u62cb\u51fa\u932f\u8aa4\u3002"]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"\u9078\u9805",children:"\u9078\u9805"}),"\n",(0,n.jsx)(s.h3,{id:"maxdiffpixels",children:"maxDiffPixels"}),"\n",(0,n.jsxs)(s.p,{children:["Playwright Test \u4f7f\u7528 ",(0,n.jsx)(s.a,{href:"https://github.com/mapbox/pixelmatch",children:"pixelmatch"})," \u51fd\u5f0f\u5eab\u3002\u4f60\u53ef\u4ee5",(0,n.jsx)(s.a,{href:"/docs/api/class-pageassertions#page-assertions-to-have-screenshot-1",children:"\u50b3\u905e\u5404\u7a2e\u9078\u9805"}),"\u4f86\u4fee\u6539\u5176\u884c\u70ba:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-js",metastring:'title="example.spec.ts"',children:"import { test, expect } from '@playwright/test';\n\ntest('example test', async ({ page }) => {\n  await page.goto('https://playwright.dev');\n  await expect(page).toHaveScreenshot({ maxDiffPixels: 100 });\n});\n"})}),"\n",(0,n.jsx)(s.p,{children:"\u5982\u679c\u4f60\u60f3\u5728\u5c08\u6848\u4e2d\u7684\u6240\u6709\u6e2c\u8a66\u4e4b\u9593\u5171\u4eab\u9810\u8a2d\u503c\uff0c\u4f60\u53ef\u4ee5\u5728 Playwright \u914d\u7f6e\u4e2d\u6307\u5b9a\u5b83\uff0c\u53ef\u4ee5\u662f\u5168\u57df\u7684\u6216\u6bcf\u500b\u5c08\u6848\u7684:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-js",metastring:'title="playwright.config.ts"',children:"import { defineConfig } from '@playwright/test';\nexport default defineConfig({\n  expect: {\n    toHaveScreenshot: { maxDiffPixels: 100 },\n  },\n});\n"})}),"\n",(0,n.jsx)(s.h3,{id:"stylepath",children:"stylePath"}),"\n",(0,n.jsx)(s.p,{children:"\u60a8\u53ef\u4ee5\u5728\u622a\u5716\u6642\u5c07\u81ea\u8a02\u6a23\u5f0f\u8868\u61c9\u7528\u5230\u60a8\u7684\u9801\u9762\u3002\u9019\u6a23\u53ef\u4ee5\u904e\u6ffe\u6389\u52d5\u614b\u6216\u6613\u8b8a\u7684\u5143\u7d20\uff0c\u5f9e\u800c\u63d0\u9ad8\u622a\u5716\u7684\u78ba\u5b9a\u6027\u3002"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-css",metastring:'title="screenshot.css"',children:"iframe {\n  visibility: hidden;\n}\n"})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-js",metastring:'title="example.spec.ts"',children:"import { test, expect } from '@playwright/test';\n\ntest('example test', async ({ page }) => {\n  await page.goto('https://playwright.dev');\n  await expect(page).toHaveScreenshot({ stylePath: path.join(__dirname, 'screenshot.css') });\n});\n"})}),"\n",(0,n.jsx)(s.p,{children:"\u5982\u679c\u4f60\u60f3\u5728\u5c08\u6848\u4e2d\u7684\u6240\u6709\u6e2c\u8a66\u4e4b\u9593\u5171\u4eab\u9810\u8a2d\u503c\uff0c\u4f60\u53ef\u4ee5\u5728 Playwright \u914d\u7f6e\u4e2d\u6307\u5b9a\u5b83\uff0c\u53ef\u4ee5\u662f\u5168\u57df\u7684\u6216\u6bcf\u500b\u5c08\u6848\u7684:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-js",metastring:'title="playwright.config.ts"',children:"import { defineConfig } from '@playwright/test';\nexport default defineConfig({\n  expect: {\n    toHaveScreenshot: {\n      stylePath: './screenshot.css'\n    },\n  },\n});\n"})}),"\n",(0,n.jsx)(s.h2,{id:"\u975e\u5f71\u50cf\u5feb\u7167",children:"\u975e\u5f71\u50cf\u5feb\u7167"}),"\n",(0,n.jsxs)(s.p,{children:["\u9664\u4e86\u622a\u5716\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 ",(0,n.jsx)(s.code,{children:"expect(value).toMatchSnapshot(snapshotName)"})," \u4f86\u6bd4\u8f03\u6587\u5b57\u6216\u4efb\u610f\u4e8c\u9032\u4f4d\u8cc7\u6599\u3002Playwright Test \u81ea\u52d5\u5075\u6e2c\u5167\u5bb9\u985e\u578b\u4e26\u4f7f\u7528\u9069\u7576\u7684\u6bd4\u8f03\u6f14\u7b97\u6cd5\u3002"]}),"\n",(0,n.jsx)(s.p,{children:"\u5728\u9019\u88e1\uff0c\u6211\u5011\u5c07\u6587\u672c\u5167\u5bb9\u8207\u53c3\u8003\u9032\u884c\u6bd4\u8f03\u3002"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-js",metastring:'title="example.spec.ts"',children:"import { test, expect } from '@playwright/test';\n\ntest('example test', async ({ page }) => {\n  await page.goto('https://playwright.dev');\n  expect(await page.textContent('.hero__title')).toMatchSnapshot('hero.txt');\n});\n"})}),"\n",(0,n.jsxs)(s.p,{children:["\u5feb\u7167\u6703\u5132\u5b58\u5728\u6e2c\u8a66\u6587\u4ef6\u65c1\u908a\u7684\u4e00\u500b\u55ae\u7368\u76ee\u9304\u4e2d\u3002\u4f8b\u5982\uff0c",(0,n.jsx)(s.code,{children:"my.spec.ts"})," \u6587\u4ef6\u5c07\u5728 ",(0,n.jsx)(s.code,{children:"my.spec.ts-snapshots"})," \u76ee\u9304\u4e2d\u751f\u6210\u4e26\u5132\u5b58\u5feb\u7167\u3002\u4f60\u61c9\u8a72\u5c07\u6b64\u76ee\u9304\u63d0\u4ea4\u5230\u4f60\u7684\u7248\u672c\u63a7\u5236\uff08\u4f8b\u5982 ",(0,n.jsx)(s.code,{children:"git"}),"\uff09\uff0c\u4e26\u5be9\u67e5\u5c0d\u5b83\u7684\u4efb\u4f55\u66f4\u6539\u3002"]})]})}function o(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(p,{...e})}):p(e)}}}]);