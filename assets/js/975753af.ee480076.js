"use strict";(self.webpackChunkplaywright_dev=self.webpackChunkplaywright_dev||[]).push([[2186],{1503:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>o,toc:()=>h});var n=s(4848),a=s(8453);s(4235),s(8328),s(3078);const r={id:"test-snapshots",title:"Visual comparisons"},i=void 0,o={id:"test-snapshots",title:"Visual comparisons",description:"Introduction",source:"@site/docs/test-snapshots.mdx",sourceDirName:".",slug:"/test-snapshots",permalink:"/docs/next/test-snapshots",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"test-snapshots",title:"Visual comparisons"},sidebar:"docs",previous:{title:"Screenshots",permalink:"/docs/next/screenshots"},next:{title:"Test generator",permalink:"/docs/next/codegen"}},c={},h=[{value:"Introduction",id:"introduction",level:2},{value:"Generating screenshots",id:"generating-screenshots",level:2},{value:"Updating screenshots",id:"updating-screenshots",level:2},{value:"Options",id:"options",level:2},{value:"maxDiffPixels",id:"maxdiffpixels",level:3},{value:"stylePath",id:"stylepath",level:3},{value:"Non-image snapshots",id:"non-image-snapshots",level:2}];function l(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,n.jsxs)(t.p,{children:["Playwright Test includes the ability to produce and visually compare screenshots using ",(0,n.jsx)(t.code,{children:"await expect(page).toHaveScreenshot()"}),". On first execution, Playwright test will generate reference screenshots. Subsequent runs will compare against the reference."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",metastring:'title="example.spec.ts"',children:"import { test, expect } from '@playwright/test';\n\ntest('example test', async ({ page }) => {\n  await page.goto('https://playwright.dev');\n  await expect(page).toHaveScreenshot();\n});\n"})}),"\n",(0,n.jsx)(t.h2,{id:"generating-screenshots",children:"Generating screenshots"}),"\n",(0,n.jsx)(t.p,{children:"When you run above for the first time, test runner will say:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-txt",children:"Error: A snapshot doesn't exist at example.spec.ts-snapshots/example-test-1-chromium-darwin.png, writing actual.\n"})}),"\n",(0,n.jsx)(t.p,{children:"That's because there was no golden file yet. This method took a bunch of screenshots until two consecutive screenshots matched, and saved the last screenshot to file system. It is now ready to be added to the repository."}),"\n",(0,n.jsx)(t.p,{children:"The name of the folder with the golden expectations starts with the name of your test file:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"drwxr-xr-x  5 user  group  160 Jun  4 11:46 .\ndrwxr-xr-x  6 user  group  192 Jun  4 11:45 ..\n-rw-r--r--  1 user  group  231 Jun  4 11:16 example.spec.ts\ndrwxr-xr-x  3 user  group   96 Jun  4 11:46 example.spec.ts-snapshots\n"})}),"\n",(0,n.jsxs)(t.p,{children:["The snapshot name ",(0,n.jsx)(t.code,{children:"example-test-1-chromium-darwin.png"})," consists of a few parts:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"example-test-1.png"})," - an auto-generated name of the snapshot. Alternatively you can specify snapshot name as the first argument of the ",(0,n.jsx)(t.code,{children:"toHaveScreenshot()"})," method:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:"await expect(page).toHaveScreenshot('landing.png');\n"})}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"chromium-darwin"})," - the browser name and the platform. Screenshots differ between browsers and platforms due to different rendering, fonts and more, so you will need different snapshots for them. If you use multiple projects in your ",(0,n.jsx)(t.a,{href:"/docs/next/test-configuration",children:"configuration file"}),", project name will be used instead of ",(0,n.jsx)(t.code,{children:"chromium"}),"."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["The snapshot name and path can be configured with ",(0,n.jsx)(t.a,{href:"./api/class-testproject#test-project-snapshot-path-template",children:(0,n.jsx)(t.code,{children:"snapshotPathTemplate"})})," in the playwright config."]}),"\n",(0,n.jsx)(t.h2,{id:"updating-screenshots",children:"Updating screenshots"}),"\n",(0,n.jsxs)(t.p,{children:["Sometimes you need to update the reference screenshot, for example when the page has changed. Do this with the  ",(0,n.jsx)(t.code,{children:"--update-snapshots"})," flag."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"npx playwright test --update-snapshots\n"})}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsxs)(t.p,{children:["Note that ",(0,n.jsx)(t.code,{children:"snapshotName"})," also accepts an array of path segments to the snapshot file such as ",(0,n.jsx)(t.code,{children:"expect().toHaveScreenshot(['relative', 'path', 'to', 'snapshot.png'])"}),".\nHowever, this path must stay within the snapshots directory for each test file (i.e. ",(0,n.jsx)(t.code,{children:"a.spec.js-snapshots"}),"), otherwise it will throw."]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"options",children:"Options"}),"\n",(0,n.jsx)(t.h3,{id:"maxdiffpixels",children:"maxDiffPixels"}),"\n",(0,n.jsxs)(t.p,{children:["Playwright Test uses the ",(0,n.jsx)(t.a,{href:"https://github.com/mapbox/pixelmatch",children:"pixelmatch"})," library. You can ",(0,n.jsx)(t.a,{href:"/docs/next/api/class-pageassertions#page-assertions-to-have-screenshot-1",children:"pass various options"})," to modify its behavior:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",metastring:'title="example.spec.ts"',children:"import { test, expect } from '@playwright/test';\n\ntest('example test', async ({ page }) => {\n  await page.goto('https://playwright.dev');\n  await expect(page).toHaveScreenshot({ maxDiffPixels: 100 });\n});\n"})}),"\n",(0,n.jsx)(t.p,{children:"If you'd like to share the default value among all the tests in the project, you can specify it in the playwright config, either globally or per project:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",metastring:'title="playwright.config.ts"',children:"import { defineConfig } from '@playwright/test';\nexport default defineConfig({\n  expect: {\n    toHaveScreenshot: { maxDiffPixels: 100 },\n  },\n});\n"})}),"\n",(0,n.jsx)(t.h3,{id:"stylepath",children:"stylePath"}),"\n",(0,n.jsx)(t.p,{children:"You can apply a custom stylesheet to your page while taking screenshot. This allows filtering out dynamic or volatile elements, hence improving the screenshot determinism."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-css",metastring:'title="screenshot.css"',children:"iframe {\n  visibility: hidden;\n}\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",metastring:'title="example.spec.ts"',children:"import { test, expect } from '@playwright/test';\n\ntest('example test', async ({ page }) => {\n  await page.goto('https://playwright.dev');\n  await expect(page).toHaveScreenshot({ stylePath: path.join(__dirname, 'screenshot.css') });\n});\n"})}),"\n",(0,n.jsx)(t.p,{children:"If you'd like to share the default value among all the tests in the project, you can specify it in the playwright config, either globally or per project:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",metastring:'title="playwright.config.ts"',children:"import { defineConfig } from '@playwright/test';\nexport default defineConfig({\n  expect: {\n    toHaveScreenshot: {\n      stylePath: './screenshot.css'\n    },\n  },\n});\n"})}),"\n",(0,n.jsx)(t.h2,{id:"non-image-snapshots",children:"Non-image snapshots"}),"\n",(0,n.jsxs)(t.p,{children:["Apart from screenshots, you can use ",(0,n.jsx)(t.code,{children:"expect(value).toMatchSnapshot(snapshotName)"})," to compare text or arbitrary binary data. Playwright Test auto-detects the content type and uses the appropriate comparison algorithm."]}),"\n",(0,n.jsx)(t.p,{children:"Here we compare text content against the reference."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",metastring:'title="example.spec.ts"',children:"import { test, expect } from '@playwright/test';\n\ntest('example test', async ({ page }) => {\n  await page.goto('https://playwright.dev');\n  expect(await page.textContent('.hero__title')).toMatchSnapshot('hero.txt');\n});\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Snapshots are stored next to the test file, in a separate directory. For example, ",(0,n.jsx)(t.code,{children:"my.spec.ts"})," file will produce and store snapshots in the ",(0,n.jsx)(t.code,{children:"my.spec.ts-snapshots"})," directory. You should commit this directory to your version control (e.g. ",(0,n.jsx)(t.code,{children:"git"}),"), and review any changes to it."]})]})}function p(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}}}]);