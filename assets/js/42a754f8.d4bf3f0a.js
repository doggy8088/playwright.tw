"use strict";(self.webpackChunkplaywright_dev=self.webpackChunkplaywright_dev||[]).push([[8164],{4733:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>l,frontMatter:()=>a,metadata:()=>i,toc:()=>d});var s=t(4848),o=t(8453);t(4235),t(8328),t(3078);const a={id:"chrome-extensions",title:"Chrome \u64f4\u5145\u529f\u80fd"},r=void 0,i={id:"chrome-extensions",title:"Chrome \u64f4\u5145\u529f\u80fd",description:"\u7c21\u4ecb",source:"@site/versioned_docs/version-stable/chrome-extensions.mdx",sourceDirName:".",slug:"/chrome-extensions",permalink:"/docs/chrome-extensions",draft:!1,unlisted:!1,tags:[],version:"stable",frontMatter:{id:"chrome-extensions",title:"Chrome \u64f4\u5145\u529f\u80fd"},sidebar:"docs",previous:{title:"\u700f\u89bd\u5668",permalink:"/docs/browsers"},next:{title:"\u6642\u9418",permalink:"/docs/clock"}},c={},d=[{value:"\u7c21\u4ecb",id:"\u7c21\u4ecb",level:2},{value:"\u6e2c\u8a66",id:"\u6e2c\u8a66",level:2},{value:"\u7121\u982d\u6a21\u5f0f",id:"\u7121\u982d\u6a21\u5f0f",level:2}];function x(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"\u7c21\u4ecb",children:"\u7c21\u4ecb"}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"\u64f4\u5145\u529f\u80fd\u50c5\u5728\u4f7f\u7528\u6301\u4e45\u6027\u4e0a\u4e0b\u6587\u555f\u52d5\u7684 Chrome / Chromium \u4e2d\u5de5\u4f5c\u3002\u4f7f\u7528\u81ea\u8a02\u700f\u89bd\u5668\u53c3\u6578\u9700\u81ea\u884c\u627f\u64d4\u98a8\u96aa\uff0c\u56e0\u70ba\u5176\u4e2d\u4e00\u4e9b\u53ef\u80fd\u6703\u7834\u58de Playwright \u529f\u80fd\u3002"})}),"\n",(0,s.jsxs)(n.p,{children:["\u4ee5\u4e0b\u662f\u53d6\u5f97 ",(0,s.jsx)(n.a,{href:"https://developer.chrome.com/extensions/background_pages",children:"background page"})," \u7684\u7a0b\u5f0f\u78bc\uff0c\u9019\u500b ",(0,s.jsx)(n.a,{href:"https://developer.chrome.com/docs/extensions/mv2/",children:"Manifest v2"})," \u64f4\u5145\u5957\u4ef6\u7684\u4f86\u6e90\u4f4d\u65bc ",(0,s.jsx)(n.code,{children:"./my-extension"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const { chromium } = require('playwright');\n\n(async () => {\n  const pathToExtension = require('path').join(__dirname, 'my-extension');\n  const userDataDir = '/tmp/test-user-data-dir';\n  const browserContext = await chromium.launchPersistentContext(userDataDir, {\n    headless: false,\n    args: [\n      `--disable-extensions-except=${pathToExtension}`,\n      `--load-extension=${pathToExtension}`\n    ]\n  });\n  let [backgroundPage] = browserContext.backgroundPages();\n  if (!backgroundPage)\n    backgroundPage = await browserContext.waitForEvent('backgroundpage');\n\n  // Test the background page as you would any other page.\n  await browserContext.close();\n})();\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u6e2c\u8a66",children:"\u6e2c\u8a66"}),"\n",(0,s.jsx)(n.p,{children:"\u70ba\u4e86\u5728\u57f7\u884c\u6e2c\u8a66\u6642\u8f09\u5165\u64f4\u5145\u529f\u80fd\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u6e2c\u8a66\u88dd\u7f6e\u4f86\u8a2d\u5b9a\u4e0a\u4e0b\u6587\u3002\u60a8\u4e5f\u53ef\u4ee5\u52d5\u614b\u6aa2\u7d22\u64f4\u5145\u529f\u80fd ID\uff0c\u4e26\u4f7f\u7528\u5b83\u4f86\u8f09\u5165\u548c\u6e2c\u8a66\u5f48\u51fa\u9801\u9762\u7bc4\u4f8b\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u9996\u5148\uff0c\u65b0\u589e\u5c07\u8f09\u5165\u64f4\u5145\u529f\u80fd\u7684\u56fa\u5b9a\u88dd\u7f6e:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",metastring:'title="fixtures.ts"',children:"import { test as base, chromium, type BrowserContext } from '@playwright/test';\nimport path from 'path';\n\nexport const test = base.extend<{\n  context: BrowserContext;\n  extensionId: string;\n}>({\n  context: async ({ }, use) => {\n    const pathToExtension = path.join(__dirname, 'my-extension');\n    const context = await chromium.launchPersistentContext('', {\n      headless: false,\n      args: [\n        `--disable-extensions-except=${pathToExtension}`,\n        `--load-extension=${pathToExtension}`,\n      ],\n    });\n    await use(context);\n    await context.close();\n  },\n  extensionId: async ({ context }, use) => {\n    /*\n    // for manifest v2:\n    let [background] = context.backgroundPages()\n    if (!background)\n      background = await context.waitForEvent('backgroundpage')\n    */\n\n    // for manifest v3:\n    let [background] = context.serviceWorkers();\n    if (!background)\n      background = await context.waitForEvent('serviceworker');\n\n    const extensionId = background.url().split('/')[2];\n    await use(extensionId);\n  },\n});\nexport const expect = test.expect;\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u7136\u5f8c\u5728\u6e2c\u8a66\u4e2d\u4f7f\u7528\u9019\u4e9b\u88dd\u7f6e:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"import { test, expect } from './fixtures';\n\ntest('example test', async ({ page }) => {\n  await page.goto('https://example.com');\n  await expect(page.locator('body')).toHaveText('Changed by my-extension');\n});\n\ntest('popup page', async ({ page, extensionId }) => {\n  await page.goto(`chrome-extension://${extensionId}/popup.html`);\n  await expect(page.locator('body')).toHaveText('my-extension popup');\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u7121\u982d\u6a21\u5f0f",children:"\u7121\u982d\u6a21\u5f0f"}),"\n",(0,s.jsx)(n.admonition,{type:"danger",children:(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"headless=new"})," \u6a21\u5f0f\u4e0d\u53d7 Playwright \u5b98\u65b9\u652f\u6301\uff0c\u53ef\u80fd\u6703\u5c0e\u81f4\u610f\u5916\u884c\u70ba\u3002"]})}),"\n",(0,s.jsx)(n.p,{children:"\u9810\u8a2d\u60c5\u6cc1\u4e0b\uff0cChrome \u5728 Playwright \u4e2d\u7684\u7121\u982d\u6a21\u5f0f\u4e0d\u652f\u63f4 Chrome \u64f4\u5145\u529f\u80fd\u3002\u70ba\u4e86\u514b\u670d\u9019\u4e00\u9650\u5236\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u7a0b\u5f0f\u78bc\u5728\u65b0\u7684\u7121\u982d\u6a21\u5f0f\u4e0b\u57f7\u884c Chrome \u7684\u6301\u4e45\u6027\u4e0a\u4e0b\u6587:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",metastring:'title="fixtures.ts"',children:"// ...\n\nconst pathToExtension = path.join(__dirname, 'my-extension');\nconst context = await chromium.launchPersistentContext('', {\n  headless: false,\n  args: [\n    `--headless=new`,\n    `--disable-extensions-except=${pathToExtension}`,\n    `--load-extension=${pathToExtension}`,\n  ],\n});\n// ...\n"})})]})}function l(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(x,{...e})}):x(e)}}}]);