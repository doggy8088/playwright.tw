"use strict";(self.webpackChunkplaywright_dev=self.webpackChunkplaywright_dev||[]).push([[8573],{7192:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>l,default:()=>g,frontMatter:()=>o,metadata:()=>c,toc:()=>d});var s=n(4848),a=n(8453),i=n(4235),r=n(8328);n(3078);const o={id:"auth",title:"\u8eab\u4efd\u9a57\u8b49"},l=void 0,c={id:"auth",title:"\u8eab\u4efd\u9a57\u8b49",description:"\u7c21\u4ecb",source:"@site/versioned_docs/version-stable/auth.mdx",sourceDirName:".",slug:"/auth",permalink:"/docs/auth",draft:!1,unlisted:!1,tags:[],version:"stable",frontMatter:{id:"auth",title:"\u8eab\u4efd\u9a57\u8b49"},sidebar:"docs",previous:{title:"API \u6e2c\u8a66",permalink:"/docs/api-testing"},next:{title:"\u81ea\u52d5\u7b49\u5f85",permalink:"/docs/actionability"}},h={},d=[{value:"\u7c21\u4ecb",id:"\u7c21\u4ecb",level:2},{value:"\u6838\u5fc3\u6982\u5ff5",id:"\u6838\u5fc3\u6982\u5ff5",level:2},{value:"\u57fa\u672c: \u6240\u6709\u6e2c\u8a66\u4e2d\u7684\u5171\u7528\u5e33\u6236",id:"\u57fa\u672c-\u6240\u6709\u6e2c\u8a66\u4e2d\u7684\u5171\u7528\u5e33\u6236",level:2},{value:"\u5728 UI \u6a21\u5f0f\u4e2d\u9a57\u8b49",id:"\u5728-ui-\u6a21\u5f0f\u4e2d\u9a57\u8b49",level:3},{value:"Moderate: \u6bcf\u500b\u5e73\u884c\u5de5\u4f5c\u8005\u4e00\u500b\u5e33\u6236",id:"moderate-\u6bcf\u500b\u5e73\u884c\u5de5\u4f5c\u8005\u4e00\u500b\u5e33\u6236",level:2},{value:"\u9032\u968e\u60c5\u5883",id:"\u9032\u968e\u60c5\u5883",level:2},{value:"\u4f7f\u7528 API \u8acb\u6c42\u9032\u884c\u8eab\u4efd\u9a57\u8b49",id:"\u4f7f\u7528-api-\u8acb\u6c42\u9032\u884c\u8eab\u4efd\u9a57\u8b49",level:3},{value:"\u591a\u500b\u5df2\u767b\u5165\u89d2\u8272",id:"\u591a\u500b\u5df2\u767b\u5165\u89d2\u8272",level:3},{value:"\u6e2c\u8a66\u591a\u500b\u89d2\u8272\u4e00\u8d77",id:"\u6e2c\u8a66\u591a\u500b\u89d2\u8272\u4e00\u8d77",level:3},{value:"\u6e2c\u8a66\u591a\u500b\u89d2\u8272\u8207 POM \u56fa\u5b9a\u88dd\u7f6e",id:"\u6e2c\u8a66\u591a\u500b\u89d2\u8272\u8207-pom-\u56fa\u5b9a\u88dd\u7f6e",level:3},{value:"Session storage",id:"session-storage",level:3},{value:"\u907f\u514d\u5728\u67d0\u4e9b\u6e2c\u8a66\u4e2d\u9032\u884c\u8eab\u4efd\u9a57\u8b49",id:"\u907f\u514d\u5728\u67d0\u4e9b\u6e2c\u8a66\u4e2d\u9032\u884c\u8eab\u4efd\u9a57\u8b49",level:3}];function p(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h2,{id:"\u7c21\u4ecb",children:"\u7c21\u4ecb"}),"\n",(0,s.jsxs)(t.p,{children:["Playwright \u5728\u7a31\u70ba",(0,s.jsx)(t.a,{href:"/docs/browser-contexts",children:"\u700f\u89bd\u5668\u4e0a\u4e0b\u6587"}),"\u7684\u9694\u96e2\u74b0\u5883\u4e2d\u57f7\u884c\u6e2c\u8a66\u3002\u9019\u7a2e\u9694\u96e2\u6a21\u578b\u63d0\u9ad8\u4e86\u53ef\u91cd\u73fe\u6027\u4e26\u9632\u6b62\u9023\u9396\u6e2c\u8a66\u5931\u6557\u3002\u6e2c\u8a66\u53ef\u4ee5\u52a0\u8f09\u73fe\u6709\u7684\u5df2\u9a57\u8b49\u72c0\u614b\u3002\u9019\u6d88\u9664\u4e86\u5728\u6bcf\u500b\u6e2c\u8a66\u4e2d\u9032\u884c\u8eab\u4efd\u9a57\u8b49\u7684\u9700\u8981\uff0c\u4e26\u52a0\u5feb\u4e86\u6e2c\u8a66\u57f7\u884c\u901f\u5ea6\u3002"]}),"\n",(0,s.jsx)(t.h2,{id:"\u6838\u5fc3\u6982\u5ff5",children:"\u6838\u5fc3\u6982\u5ff5"}),"\n",(0,s.jsx)(t.p,{children:"\u7121\u8ad6\u60a8\u9078\u64c7\u54ea\u7a2e\u9a57\u8b49\u7b56\u7565\uff0c\u60a8\u53ef\u80fd\u6703\u5c07\u5df2\u9a57\u8b49\u7684\u700f\u89bd\u5668\u72c0\u614b\u5b58\u5132\u5728\u6a94\u6848\u7cfb\u7d71\u4e0a\u3002"}),"\n",(0,s.jsxs)(t.p,{children:["\u6211\u5011\u5efa\u8b70\u5efa\u7acb ",(0,s.jsx)(t.code,{children:"playwright/.auth"})," \u76ee\u9304\u4e26\u5c07\u5176\u6dfb\u52a0\u5230 ",(0,s.jsx)(t.code,{children:".gitignore"})," \u4e2d\u3002\u60a8\u7684\u8eab\u4efd\u9a57\u8b49\u7a0b\u5e8f\u5c07\u751f\u6210\u5df2\u9a57\u8b49\u7684\u700f\u89bd\u5668\u72c0\u614b\u4e26\u5c07\u5176\u4fdd\u5b58\u5230\u6b64 ",(0,s.jsx)(t.code,{children:"playwright/.auth"})," \u76ee\u9304\u4e2d\u7684\u6a94\u6848\u3002\u7a0d\u5f8c\uff0c\u6e2c\u8a66\u5c07\u91cd\u7528\u6b64\u72c0\u614b\u4e26\u4ee5\u5df2\u9a57\u8b49\u7684\u65b9\u5f0f\u958b\u59cb\u3002"]}),"\n",(0,s.jsxs)(i.A,{groupId:"bash-flavor",defaultValue:"bash",values:[{label:"Bash",value:"bash"},{label:"PowerShell",value:"powershell"},{label:"Batch",value:"batch"}],children:[(0,s.jsx)(r.A,{value:"bash",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"mkdir -p playwright/.auth\necho $'\\nplaywright/.auth' >> .gitignore\n"})})}),(0,s.jsx)(r.A,{value:"powershell",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-powershell",children:'New-Item -ItemType Directory -Force -Path playwright\\.auth\nAdd-Content -path .gitignore "`r`nplaywright/.auth"\n'})})}),(0,s.jsx)(r.A,{value:"batch",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-batch",children:'md playwright\\.auth\necho. >> .gitignore\necho "playwright/.auth" >> .gitignore\n'})})})]}),"\n",(0,s.jsx)(t.h2,{id:"\u57fa\u672c-\u6240\u6709\u6e2c\u8a66\u4e2d\u7684\u5171\u7528\u5e33\u6236",children:"\u57fa\u672c: \u6240\u6709\u6e2c\u8a66\u4e2d\u7684\u5171\u7528\u5e33\u6236"}),"\n",(0,s.jsxs)(t.p,{children:["\u9019\u662f",(0,s.jsx)(t.strong,{children:"\u63a8\u85a6\u7684"}),"\u65b9\u6cd5\uff0c\u7528\u65bc",(0,s.jsx)(t.strong,{children:"\u6c92\u6709\u4f3a\u670d\u5668\u7aef\u72c0\u614b"}),"\u7684\u6e2c\u8a66\u3002\u5728",(0,s.jsx)(t.strong,{children:"\u8a2d\u5b9a\u5c08\u6848"}),"\u4e2d\u9032\u884c\u4e00\u6b21\u8eab\u4efd\u9a57\u8b49\uff0c\u4fdd\u5b58\u8eab\u4efd\u9a57\u8b49\u72c0\u614b\uff0c\u7136\u5f8c\u91cd\u8907\u4f7f\u7528\u5b83\u4f86\u555f\u52d5\u6bcf\u500b\u5df2\u7d93\u9a57\u8b49\u7684\u6e2c\u8a66\u3002"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"\u4f55\u6642\u4f7f\u7528"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"\u7576\u4f60\u53ef\u4ee5\u60f3\u50cf\u6240\u6709\u7684\u6e2c\u8a66\u540c\u6642\u4f7f\u7528\u76f8\u540c\u7684\u5e33\u6236\u57f7\u884c\uff0c\u800c\u4e0d\u6703\u4e92\u76f8\u5f71\u97ff\u6642\u3002"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"\u4f55\u6642\u4e0d\u4f7f\u7528"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"\u4f60\u7684\u6e2c\u8a66\u6703\u4fee\u6539\u4f3a\u670d\u5668\u7aef\u7684\u72c0\u614b\u3002\u4f8b\u5982\uff0c\u4e00\u500b\u6e2c\u8a66\u6aa2\u67e5\u8a2d\u5b9a\u9801\u9762\u7684\u6e32\u67d3\uff0c\u800c\u53e6\u4e00\u500b\u6e2c\u8a66\u6b63\u5728\u66f4\u6539\u8a2d\u5b9a\uff0c\u4e26\u4e14\u4f60\u5e73\u884c\u57f7\u884c\u6e2c\u8a66\u3002\u5728\u9019\u7a2e\u60c5\u6cc1\u4e0b\uff0c\u6e2c\u8a66\u5fc5\u9808\u4f7f\u7528\u4e0d\u540c\u7684\u5e33\u6236\u3002"}),"\n",(0,s.jsx)(t.li,{children:"\u4f60\u7684\u8eab\u4efd\u9a57\u8b49\u662f\u7279\u5b9a\u65bc\u700f\u89bd\u5668\u7684\u3002"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"\u7d30\u7bc0"})}),"\n",(0,s.jsxs)(t.p,{children:["\u5efa\u7acb ",(0,s.jsx)(t.code,{children:"tests/auth.setup.ts"})," \u4f86\u70ba\u6240\u6709\u5176\u4ed6\u6e2c\u8a66\u6e96\u5099\u5df2\u9a57\u8b49\u7684\u700f\u89bd\u5668\u72c0\u614b\u3002"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:'title="tests/auth.setup.ts"',children:"import { test as setup, expect } from '@playwright/test';\nimport path from 'path';\n\nconst authFile = path.join(__dirname, '../playwright/.auth/user.json');\n\nsetup('authenticate', async ({ page }) => {\n  // Perform authentication steps. Replace these actions with your own.\n  await page.goto('https://github.com/login');\n  await page.getByLabel('Username or email address').fill('username');\n  await page.getByLabel('Password').fill('password');\n  await page.getByRole('button', { name: 'Sign in' }).click();\n  // Wait until the page receives the cookies.\n  //\n  // Sometimes login flow sets cookies in the process of several redirects.\n  // Wait for the final URL to ensure that the cookies are actually set.\n  await page.waitForURL('https://github.com/');\n  // Alternatively, you can wait until the page reaches a state where all cookies are set.\n  await expect(page.getByRole('button', { name: 'View profile and more' })).toBeVisible();\n\n  // End of authentication steps.\n\n  await page.context().storageState({ path: authFile });\n});\n"})}),"\n",(0,s.jsxs)(t.p,{children:["\u5efa\u7acb\u4e00\u500b\u65b0\u7684 ",(0,s.jsx)(t.code,{children:"setup"})," \u5c08\u6848\u5728 config \u4e2d\uff0c\u4e26\u5c07\u5176\u5ba3\u544a\u70ba\u6240\u6709\u6e2c\u8a66\u5c08\u6848\u7684",(0,s.jsx)(t.a,{href:"/docs/test-projects#dependencies",children:"\u76f8\u4f9d\u5957\u4ef6"}),"\u3002\u6b64\u5c08\u6848\u5c07\u5728\u6240\u6709\u6e2c\u8a66\u4e4b\u524d\u57f7\u884c\u4e26\u9032\u884c\u9a57\u8b49\u3002\u6240\u6709\u6e2c\u8a66\u5c08\u6848\u61c9\u4f7f\u7528\u9a57\u8b49\u904e\u7684\u72c0\u614b\u4f5c\u70ba ",(0,s.jsx)(t.code,{children:"storageState"}),"\u3002"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:'title="playwright.config.ts"',children:"import { defineConfig, devices } from '@playwright/test';\n\nexport default defineConfig({\n  projects: [\n    // Setup project\n    { name: 'setup', testMatch: /.*\\.setup\\.ts/ },\n\n    {\n      name: 'chromium',\n      use: {\n        ...devices['Desktop Chrome'],\n        // Use prepared auth state.\n        storageState: 'playwright/.auth/user.json',\n      },\n      dependencies: ['setup'],\n    },\n\n    {\n      name: 'firefox',\n      use: {\n        ...devices['Desktop Firefox'],\n        // Use prepared auth state.\n        storageState: 'playwright/.auth/user.json',\n      },\n      dependencies: ['setup'],\n    },\n  ],\n});\n"})}),"\n",(0,s.jsxs)(t.p,{children:["\u6e2c\u8a66\u958b\u59cb\u6642\u5df2\u7d93\u904e\u8eab\u4efd\u9a57\u8b49\uff0c\u56e0\u70ba\u6211\u5011\u5728\u914d\u7f6e\u4e2d\u6307\u5b9a\u4e86 ",(0,s.jsx)(t.code,{children:"storageState"}),"\u3002"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:'title="tests/example.spec.ts"',children:"import { test } from '@playwright/test';\n\ntest('test', async ({ page }) => {\n  // page is authenticated\n});\n"})}),"\n",(0,s.jsxs)(t.p,{children:["\u6ce8\u610f\uff0c\u4f60\u9700\u8981\u5728\u72c0\u614b\u904e\u671f\u6642\u522a\u9664\u5132\u5b58\u7684\u72c0\u614b\u3002\u5982\u679c\u4f60\u4e0d\u9700\u8981\u5728\u6e2c\u8a66\u57f7\u884c\u4e4b\u9593\u4fdd\u7559\u72c0\u614b\uff0c\u8acb\u5c07\u700f\u89bd\u5668\u72c0\u614b\u5beb\u5165 ",(0,s.jsx)(t.a,{href:"/docs/api/class-testproject#test-project-output-dir",children:"testProject.outputDir"}),"\uff0c\u9019\u6703\u5728\u6bcf\u6b21\u6e2c\u8a66\u57f7\u884c\u524d\u81ea\u52d5\u6e05\u7406\u3002"]}),"\n",(0,s.jsx)(t.h3,{id:"\u5728-ui-\u6a21\u5f0f\u4e2d\u9a57\u8b49",children:"\u5728 UI \u6a21\u5f0f\u4e2d\u9a57\u8b49"}),"\n",(0,s.jsxs)(t.p,{children:["UI mode \u5c07\u4e0d\u6703\u9810\u8a2d\u57f7\u884c ",(0,s.jsx)(t.code,{children:"setup"})," \u5c08\u6848\u4ee5\u63d0\u9ad8\u6e2c\u8a66\u901f\u5ea6\u3002\u6211\u5011\u5efa\u8b70\u5728\u73fe\u6709\u8eab\u4efd\u9a57\u8b49\u904e\u671f\u6642\uff0c\u5076\u723e\u624b\u52d5\u57f7\u884c ",(0,s.jsx)(t.code,{children:"auth.setup.ts"})," \u4f86\u9032\u884c\u8eab\u4efd\u9a57\u8b49\u3002"]}),"\n",(0,s.jsxs)(t.p,{children:["\u9996\u5148",(0,s.jsxs)(t.a,{href:"./test-ui-mode#filtering-tests",children:["\u5728\u7be9\u9078\u5668\u4e2d\u555f\u7528 ",(0,s.jsx)(t.code,{children:"setup"})," \u5c08\u6848"]}),"\uff0c\u7136\u5f8c\u9ede\u64ca ",(0,s.jsx)(t.code,{children:"auth.setup.ts"})," \u6587\u4ef6\u65c1\u908a\u7684\u4e09\u89d2\u5f62\u6309\u9215\uff0c\u7136\u5f8c\u518d\u6b21\u5728\u7be9\u9078\u5668\u4e2d\u505c\u7528 ",(0,s.jsx)(t.code,{children:"setup"})," \u5c08\u6848\u3002"]}),"\n",(0,s.jsx)(t.h2,{id:"moderate-\u6bcf\u500b\u5e73\u884c\u5de5\u4f5c\u8005\u4e00\u500b\u5e33\u6236",children:"Moderate: \u6bcf\u500b\u5e73\u884c\u5de5\u4f5c\u8005\u4e00\u500b\u5e33\u6236"}),"\n",(0,s.jsxs)(t.p,{children:["\u9019\u662f",(0,s.jsx)(t.strong,{children:"\u63a8\u85a6"}),"\u7684\u6e2c\u8a66\u65b9\u6cd5\uff0c\u7528\u65bc",(0,s.jsx)(t.strong,{children:"\u4fee\u6539\u4f3a\u670d\u5668\u7aef\u72c0\u614b"}),"\u3002\u5728 Playwright \u4e2d\uff0c\u5de5\u4f5c\u7a0b\u5e8f\u5e73\u884c\u57f7\u884c\u3002\u5728\u9019\u7a2e\u65b9\u6cd5\u4e2d\uff0c\u6bcf\u500b\u5e73\u884c\u5de5\u4f5c\u7a0b\u5e8f\u53ea\u9700\u8a8d\u8b49\u4e00\u6b21\u3002\u6240\u6709\u7531\u5de5\u4f5c\u7a0b\u5e8f\u57f7\u884c\u7684\u6e2c\u8a66\u90fd\u6703\u91cd\u7528\u76f8\u540c\u7684\u8a8d\u8b49\u72c0\u614b\u3002\u6211\u5011\u5c07\u9700\u8981\u591a\u500b\u6e2c\u8a66\u5e33\u6236\uff0c\u6bcf\u500b\u5e73\u884c\u5de5\u4f5c\u7a0b\u5e8f\u4e00\u500b\u3002"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"\u4f55\u6642\u4f7f\u7528"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"\u60a8\u7684\u6e2c\u8a66\u6703\u4fee\u6539\u5171\u4eab\u7684\u4f3a\u670d\u5668\u7aef\u72c0\u614b\u3002\u4f8b\u5982\uff0c\u4e00\u500b\u6e2c\u8a66\u6aa2\u67e5\u8a2d\u5b9a\u9801\u9762\u7684\u6e32\u67d3\uff0c\u800c\u53e6\u4e00\u500b\u6e2c\u8a66\u5247\u5728\u66f4\u6539\u8a2d\u5b9a\u3002"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"\u4f55\u6642\u4e0d\u4f7f\u7528"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"\u60a8\u7684\u6e2c\u8a66\u4e0d\u6703\u4fee\u6539\u4efb\u4f55\u5171\u4eab\u7684\u4f3a\u670d\u5668\u7aef\u72c0\u614b\u3002\u5728\u9019\u7a2e\u60c5\u6cc1\u4e0b\uff0c\u6240\u6709\u6e2c\u8a66\u90fd\u53ef\u4ee5\u4f7f\u7528\u55ae\u4e00\u5171\u4eab\u5e33\u6236\u3002"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"\u7d30\u7bc0"})}),"\n",(0,s.jsxs)(t.p,{children:["\u6211\u5011\u5c07\u5728\u6bcf\u500b",(0,s.jsx)(t.a,{href:"/docs/test-parallel#worker-processes",children:"worker process"}),"\u4e2d\u9032\u884c\u4e00\u6b21\u8eab\u4efd\u9a57\u8b49\uff0c\u6bcf\u500b\u90fd\u6709\u4e00\u500b\u552f\u4e00\u7684\u5e33\u6236\u3002"]}),"\n",(0,s.jsxs)(t.p,{children:["\u5efa\u7acb ",(0,s.jsx)(t.code,{children:"playwright/fixtures.ts"})," \u6a94\u6848\u4f86",(0,s.jsxs)(t.a,{href:"/docs/test-fixtures#overriding-fixtures",children:["\u8986\u5beb ",(0,s.jsx)(t.code,{children:"storageState"})," fixture"]}),"\u4ee5\u6bcf\u500b worker \u8a8d\u8b49\u4e00\u6b21\u3002\u4f7f\u7528 ",(0,s.jsx)(t.a,{href:"/docs/api/class-testinfo#test-info-parallel-index",children:"testInfo.parallelIndex"})," \u4f86\u5340\u5206 worker\u3002"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:'title="playwright/fixtures.ts"',children:"import { test as baseTest, expect } from '@playwright/test';\nimport fs from 'fs';\nimport path from 'path';\n\nexport * from '@playwright/test';\nexport const test = baseTest.extend<{}, { workerStorageState: string }>({\n  // Use the same storage state for all tests in this worker.\n  storageState: ({ workerStorageState }, use) => use(workerStorageState),\n\n  // Authenticate once per worker with a worker-scoped fixture.\n  workerStorageState: [async ({ browser }, use) => {\n    // Use parallelIndex as a unique identifier for each worker.\n    const id = test.info().parallelIndex;\n    const fileName = path.resolve(test.info().project.outputDir, `.auth/${id}.json`);\n\n    if (fs.existsSync(fileName)) {\n      // Reuse existing authentication state if any.\n      await use(fileName);\n      return;\n    }\n\n    // Important: make sure we authenticate in a clean environment by unsetting storage state.\n    const page = await browser.newPage({ storageState: undefined });\n\n    // Acquire a unique account, for example create a new one.\n    // Alternatively, you can have a list of precreated accounts for testing.\n    // Make sure that accounts are unique, so that multiple team members\n    // can run tests at the same time without interference.\n    const account = await acquireAccount(id);\n\n    // Perform authentication steps. Replace these actions with your own.\n    await page.goto('https://github.com/login');\n    await page.getByLabel('Username or email address').fill(account.username);\n    await page.getByLabel('Password').fill(account.password);\n    await page.getByRole('button', { name: 'Sign in' }).click();\n    // Wait until the page receives the cookies.\n    //\n    // Sometimes login flow sets cookies in the process of several redirects.\n    // Wait for the final URL to ensure that the cookies are actually set.\n    await page.waitForURL('https://github.com/');\n    // Alternatively, you can wait until the page reaches a state where all cookies are set.\n    await expect(page.getByRole('button', { name: 'View profile and more' })).toBeVisible();\n\n    // End of authentication steps.\n\n    await page.context().storageState({ path: fileName });\n    await page.close();\n    await use(fileName);\n  }, { scope: 'worker' }],\n});\n"})}),"\n",(0,s.jsxs)(t.p,{children:["\u73fe\u5728\uff0c\u6bcf\u500b\u6e2c\u8a66\u6587\u4ef6\u61c9\u8a72\u5f9e\u6211\u5011\u7684 fixtures \u6587\u4ef6\u4e2d\u532f\u5165 ",(0,s.jsx)(t.code,{children:"test"}),"\uff0c\u800c\u4e0d\u662f\u5f9e ",(0,s.jsx)(t.code,{children:"@playwright/test"}),"\u3002\u914d\u7f6e\u4e2d\u4e0d\u9700\u8981\u9032\u884c\u4efb\u4f55\u66f4\u6539\u3002"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:'title="tests/example.spec.ts"',children:"// Important: import our fixtures.\nimport { test, expect } from '../playwright/fixtures';\n\ntest('test', async ({ page }) => {\n  // page is authenticated\n});\n"})}),"\n",(0,s.jsx)(t.h2,{id:"\u9032\u968e\u60c5\u5883",children:"\u9032\u968e\u60c5\u5883"}),"\n",(0,s.jsx)(t.h3,{id:"\u4f7f\u7528-api-\u8acb\u6c42\u9032\u884c\u8eab\u4efd\u9a57\u8b49",children:"\u4f7f\u7528 API \u8acb\u6c42\u9032\u884c\u8eab\u4efd\u9a57\u8b49"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"\u4f55\u6642\u4f7f\u7528"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"\u60a8\u7684 web \u61c9\u7528\u7a0b\u5f0f\u652f\u63f4\u901a\u904e API \u9a57\u8b49\uff0c\u9019\u6bd4\u8207\u61c9\u7528\u7a0b\u5f0f UI \u4e92\u52d5\u66f4\u7c21\u55ae/\u66f4\u5feb\u3002"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"\u7d30\u7bc0"})}),"\n",(0,s.jsxs)(t.p,{children:["\u6211\u5011\u5c07\u4f7f\u7528 ",(0,s.jsx)(t.a,{href:"/docs/api/class-apirequestcontext",title:"APIRequestContext",children:"APIRequestContext"})," \u767c\u9001 API \u8acb\u6c42\uff0c\u7136\u5f8c\u50cf\u5f80\u5e38\u4e00\u6a23\u4fdd\u5b58\u5df2\u9a57\u8b49\u7684\u72c0\u614b\u3002"]}),"\n",(0,s.jsxs)(t.p,{children:["\u5728 ",(0,s.jsx)(t.a,{href:"#basic-shared-account-in-all-tests",children:"\u8a2d\u5b9a\u5c08\u6848"})," \u4e2d:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:'title="tests/auth.setup.ts"',children:"import { test as setup } from '@playwright/test';\n\nconst authFile = 'playwright/.auth/user.json';\n\nsetup('authenticate', async ({ request }) => {\n  // Send authentication request. Replace with your own.\n  await request.post('https://github.com/login', {\n    form: {\n      'user': 'user',\n      'password': 'password'\n    }\n  });\n  await request.storageState({ path: authFile });\n});\n"})}),"\n",(0,s.jsxs)(t.p,{children:["\u6216\u8005\uff0c\u5728 ",(0,s.jsx)(t.a,{href:"#moderate-one-account-per-parallel-worker",children:"worker fixture"})," \u4e2d:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:'title="playwright/fixtures.ts"',children:"import { test as baseTest, request } from '@playwright/test';\nimport fs from 'fs';\nimport path from 'path';\n\nexport * from '@playwright/test';\nexport const test = baseTest.extend<{}, { workerStorageState: string }>({\n  // Use the same storage state for all tests in this worker.\n  storageState: ({ workerStorageState }, use) => use(workerStorageState),\n\n  // Authenticate once per worker with a worker-scoped fixture.\n  workerStorageState: [async ({}, use) => {\n    // Use parallelIndex as a unique identifier for each worker.\n    const id = test.info().parallelIndex;\n    const fileName = path.resolve(test.info().project.outputDir, `.auth/${id}.json`);\n\n    if (fs.existsSync(fileName)) {\n      // Reuse existing authentication state if any.\n      await use(fileName);\n      return;\n    }\n\n    // Important: make sure we authenticate in a clean environment by unsetting storage state.\n    const context = await request.newContext({ storageState: undefined });\n\n    // Acquire a unique account, for example create a new one.\n    // Alternatively, you can have a list of precreated accounts for testing.\n    // Make sure that accounts are unique, so that multiple team members\n    // can run tests at the same time without interference.\n    const account = await acquireAccount(id);\n\n    // Send authentication request. Replace with your own.\n    await context.post('https://github.com/login', {\n      form: {\n        'user': 'user',\n        'password': 'password'\n      }\n    });\n\n    await context.storageState({ path: fileName });\n    await context.dispose();\n    await use(fileName);\n  }, { scope: 'worker' }],\n});\n"})}),"\n",(0,s.jsx)(t.h3,{id:"\u591a\u500b\u5df2\u767b\u5165\u89d2\u8272",children:"\u591a\u500b\u5df2\u767b\u5165\u89d2\u8272"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"\u4f55\u6642\u4f7f\u7528"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"\u5728\u7aef\u5230\u7aef\u6e2c\u8a66\u4e2d\uff0c\u4f60\u6709\u591a\u500b\u89d2\u8272\uff0c\u4f46\u4f60\u53ef\u4ee5\u5728\u6240\u6709\u6e2c\u8a66\u4e2d\u91cd\u8907\u4f7f\u7528\u5e33\u6236\u3002"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"\u7d30\u7bc0"})}),"\n",(0,s.jsx)(t.p,{children:"\u6211\u5011\u5c07\u5728\u8a2d\u5b9a\u5c08\u6848\u4e2d\u591a\u6b21\u9032\u884c\u8eab\u4efd\u9a57\u8b49\u3002"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:'title="tests/auth.setup.ts"',children:"import { test as setup, expect } from '@playwright/test';\n\nconst adminFile = 'playwright/.auth/admin.json';\n\nsetup('authenticate as admin', async ({ page }) => {\n  // Perform authentication steps. Replace these actions with your own.\n  await page.goto('https://github.com/login');\n  await page.getByLabel('Username or email address').fill('admin');\n  await page.getByLabel('Password').fill('password');\n  await page.getByRole('button', { name: 'Sign in' }).click();\n  // Wait until the page receives the cookies.\n  //\n  // Sometimes login flow sets cookies in the process of several redirects.\n  // Wait for the final URL to ensure that the cookies are actually set.\n  await page.waitForURL('https://github.com/');\n  // Alternatively, you can wait until the page reaches a state where all cookies are set.\n  await expect(page.getByRole('button', { name: 'View profile and more' })).toBeVisible();\n\n  // End of authentication steps.\n\n  await page.context().storageState({ path: adminFile });\n});\n\nconst userFile = 'playwright/.auth/user.json';\n\nsetup('authenticate as user', async ({ page }) => {\n  // Perform authentication steps. Replace these actions with your own.\n  await page.goto('https://github.com/login');\n  await page.getByLabel('Username or email address').fill('user');\n  await page.getByLabel('Password').fill('password');\n  await page.getByRole('button', { name: 'Sign in' }).click();\n  // Wait until the page receives the cookies.\n  //\n  // Sometimes login flow sets cookies in the process of several redirects.\n  // Wait for the final URL to ensure that the cookies are actually set.\n  await page.waitForURL('https://github.com/');\n  // Alternatively, you can wait until the page reaches a state where all cookies are set.\n  await expect(page.getByRole('button', { name: 'View profile and more' })).toBeVisible();\n\n  // End of authentication steps.\n\n  await page.context().storageState({ path: userFile });\n});\n"})}),"\n",(0,s.jsxs)(t.p,{children:["\u4e4b\u5f8c\uff0c\u70ba\u6bcf\u500b\u6e2c\u8a66\u6587\u4ef6\u6216\u6e2c\u8a66\u7d44\u6307\u5b9a ",(0,s.jsx)(t.code,{children:"storageState"}),"\uff0c",(0,s.jsx)(t.strong,{children:"\u800c\u4e0d\u662f"}),"\u5728\u914d\u7f6e\u4e2d\u8a2d\u5b9a\u5b83\u3002"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:'title="tests/example.spec.ts"',children:"import { test } from '@playwright/test';\n\ntest.use({ storageState: 'playwright/.auth/admin.json' });\n\ntest('admin test', async ({ page }) => {\n  // page is authenticated as admin\n});\n\ntest.describe(() => {\n  test.use({ storageState: 'playwright/.auth/user.json' });\n\n  test('user test', async ({ page }) => {\n    // page is authenticated as a user\n  });\n});\n"})}),"\n",(0,s.jsxs)(t.p,{children:["\u53e6\u8acb\u53c3\u95b1",(0,s.jsx)(t.a,{href:"#authenticating-in-ui-mode",children:"\u5728 UI \u6a21\u5f0f\u4e2d\u9032\u884c\u8eab\u4efd\u9a57\u8b49"}),"\u3002"]}),"\n",(0,s.jsx)(t.h3,{id:"\u6e2c\u8a66\u591a\u500b\u89d2\u8272\u4e00\u8d77",children:"\u6e2c\u8a66\u591a\u500b\u89d2\u8272\u4e00\u8d77"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"\u4f55\u6642\u4f7f\u7528"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"\u4f60\u9700\u8981\u6e2c\u8a66\u591a\u500b\u5df2\u9a57\u8b49\u89d2\u8272\u5982\u4f55\u5728\u55ae\u4e00\u6e2c\u8a66\u4e2d\u4e92\u52d5\u3002"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"\u7d30\u7bc0"})}),"\n",(0,s.jsxs)(t.p,{children:["\u5728\u540c\u4e00\u500b\u6e2c\u8a66\u4e2d\u4f7f\u7528\u591a\u500b ",(0,s.jsx)(t.a,{href:"/docs/api/class-browsercontext",title:"BrowserContext",children:"BrowserContext"})," \u548c ",(0,s.jsx)(t.a,{href:"/docs/api/class-page",title:"Page",children:"Page"}),"\uff0c\u4e26\u5177\u6709\u4e0d\u540c\u7684\u5b58\u5132\u72c0\u614b\u3002"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:'title="tests/example.spec.ts"',children:"import { test } from '@playwright/test';\n\ntest('admin and user', async ({ browser }) => {\n  // adminContext and all pages inside, including adminPage, are signed in as \"admin\".\n  const adminContext = await browser.newContext({ storageState: 'playwright/.auth/admin.json' });\n  const adminPage = await adminContext.newPage();\n\n  // userContext and all pages inside, including userPage, are signed in as \"user\".\n  const userContext = await browser.newContext({ storageState: 'playwright/.auth/user.json' });\n  const userPage = await userContext.newPage();\n\n  // ... interact with both adminPage and userPage ...\n\n  await adminContext.close();\n  await userContext.close();\n});\n"})}),"\n",(0,s.jsx)(t.h3,{id:"\u6e2c\u8a66\u591a\u500b\u89d2\u8272\u8207-pom-\u56fa\u5b9a\u88dd\u7f6e",children:"\u6e2c\u8a66\u591a\u500b\u89d2\u8272\u8207 POM \u56fa\u5b9a\u88dd\u7f6e"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"\u4f55\u6642\u4f7f\u7528"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"\u4f60\u9700\u8981\u6e2c\u8a66\u591a\u500b\u5df2\u9a57\u8b49\u89d2\u8272\u5982\u4f55\u5728\u55ae\u4e00\u6e2c\u8a66\u4e2d\u4e92\u52d5\u3002"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"\u7d30\u7bc0"})}),"\n",(0,s.jsx)(t.p,{children:"\u4f60\u53ef\u4ee5\u5f15\u5165\u5c07\u63d0\u4f9b\u4f5c\u70ba\u6bcf\u500b\u89d2\u8272\u9a57\u8b49\u7684\u9801\u9762\u7684 fixtures\u3002"}),"\n",(0,s.jsxs)(t.p,{children:["\u4ee5\u4e0b\u662f\u4e00\u500b",(0,s.jsx)(t.a,{href:"/docs/test-fixtures#creating-a-fixture",children:"\u5efa\u7acb\u6e2c\u8a66\u593e\u5177"}),"\u7684\u7bc4\u4f8b\uff0c\u9069\u7528\u65bc\u5169\u500b",(0,s.jsx)(t.a,{href:"/docs/pom",children:"\u9801\u9762\u7269\u4ef6\u6a21\u578b"})," - admin POM \u548c user POM\u3002\u5b83\u5047\u8a2d ",(0,s.jsx)(t.code,{children:"adminStorageState.json"})," \u548c ",(0,s.jsx)(t.code,{children:"userStorageState.json"})," \u6a94\u6848\u5df2\u5728\u5168\u57df\u8a2d\u5b9a\u4e2d\u5efa\u7acb\u3002"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:'title="playwright/fixtures.ts"',children:"import { test as base, type Page, type Locator } from '@playwright/test';\n\n// Page Object Model for the \"admin\" page.\n// Here you can add locators and helper methods specific to the admin page.\nclass AdminPage {\n  // Page signed in as \"admin\".\n  page: Page;\n\n  // Example locator pointing to \"Welcome, Admin\" greeting.\n  greeting: Locator;\n\n  constructor(page: Page) {\n    this.page = page;\n    this.greeting = page.locator('#greeting');\n  }\n}\n\n// Page Object Model for the \"user\" page.\n// Here you can add locators and helper methods specific to the user page.\nclass UserPage {\n  // Page signed in as \"user\".\n  page: Page;\n\n  // Example locator pointing to \"Welcome, User\" greeting.\n  greeting: Locator;\n\n  constructor(page: Page) {\n    this.page = page;\n    this.greeting = page.locator('#greeting');\n  }\n}\n\n// Declare the types of your fixtures.\ntype MyFixtures = {\n  adminPage: AdminPage;\n  userPage: UserPage;\n};\n\nexport * from '@playwright/test';\nexport const test = base.extend<MyFixtures>({\n  adminPage: async ({ browser }, use) => {\n    const context = await browser.newContext({ storageState: 'playwright/.auth/admin.json' });\n    const adminPage = new AdminPage(await context.newPage());\n    await use(adminPage);\n    await context.close();\n  },\n  userPage: async ({ browser }, use) => {\n    const context = await browser.newContext({ storageState: 'playwright/.auth/user.json' });\n    const userPage = new UserPage(await context.newPage());\n    await use(userPage);\n    await context.close();\n  },\n});\n\n"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:'title="tests/example.spec.ts"',children:"// Import test with our new fixtures.\nimport { test, expect } from '../playwright/fixtures';\n\n// Use adminPage and userPage fixtures in the test.\ntest('admin and user', async ({ adminPage, userPage }) => {\n  // ... interact with both adminPage and userPage ...\n  await expect(adminPage.greeting).toHaveText('Welcome, Admin');\n  await expect(userPage.greeting).toHaveText('Welcome, User');\n});\n"})}),"\n",(0,s.jsx)(t.h3,{id:"session-storage",children:"Session storage"}),"\n",(0,s.jsxs)(t.p,{children:["\u91cd\u8907\u4f7f\u7528\u5df2\u9a57\u8b49\u7684\u72c0\u614b\u6db5\u84cb\u4e86",(0,s.jsx)(t.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies",children:" cookies"})," \u548c",(0,s.jsx)(t.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Storage",children:" local storage"})," \u57fa\u65bc\u9a57\u8b49\u3002\u5f88\u5c11\u4f7f\u7528",(0,s.jsx)(t.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage",children:" session storage"})," \u4f86\u5b58\u5132\u8207\u5df2\u767b\u5165\u72c0\u614b\u76f8\u95dc\u7684\u8cc7\u8a0a\u3002Session storage \u7279\u5b9a\u65bc\u67d0\u500b\u7279\u5b9a\u7684\u57df\uff0c\u4e26\u4e14\u4e0d\u6703\u5728\u9801\u9762\u52a0\u8f09\u4e4b\u9593\u6301\u7e8c\u5b58\u5728\u3002Playwright \u4e0d\u63d0\u4f9b\u6301\u4e45\u5316 session storage \u7684 API\uff0c\u4f46\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u7a0b\u5f0f\u78bc\u7247\u6bb5\u4f86\u4fdd\u5b58/\u52a0\u8f09 session storage\u3002"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"// Get session storage and store as env variable\nconst sessionStorage = await page.evaluate(() => JSON.stringify(sessionStorage));\nfs.writeFileSync('playwright/.auth/session.json', sessionStorage, 'utf-8');\n\n// Set session storage in a new context\nconst sessionStorage = JSON.parse(fs.readFileSync('playwright/.auth/session.json', 'utf-8'));\nawait context.addInitScript(storage => {\n  if (window.location.hostname === 'example.com') {\n    for (const [key, value] of Object.entries(storage))\n      window.sessionStorage.setItem(key, value);\n  }\n}, sessionStorage);\n"})}),"\n",(0,s.jsx)(t.h3,{id:"\u907f\u514d\u5728\u67d0\u4e9b\u6e2c\u8a66\u4e2d\u9032\u884c\u8eab\u4efd\u9a57\u8b49",children:"\u907f\u514d\u5728\u67d0\u4e9b\u6e2c\u8a66\u4e2d\u9032\u884c\u8eab\u4efd\u9a57\u8b49"}),"\n",(0,s.jsx)(t.p,{children:"\u60a8\u53ef\u4ee5\u5728\u6e2c\u8a66\u6587\u4ef6\u4e2d\u91cd\u65b0\u6574\u7406\u5132\u5b58\u72c0\u614b\uff0c\u4ee5\u907f\u514d\u70ba\u6574\u500b\u5c08\u6848\u8a2d\u5b9a\u7684\u8eab\u4efd\u9a57\u8b49\u3002"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:'title="not-signed-in.spec.ts"',children:"import { test } from '@playwright/test';\n\n// Reset storage state for this file to avoid being authenticated\ntest.use({ storageState: { cookies: [], origins: [] } });\n\ntest('not signed in test', async ({ page }) => {\n  // ...\n});\n"})})]})}function g(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}}}]);