"use strict";(self.webpackChunkplaywright_dev=self.webpackChunkplaywright_dev||[]).push([[3708],{2326:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>a,toc:()=>d});var i=s(4848),r=s(8453);s(4235),s(8328),s(3078);const l={id:"ci",title:"\u6301\u7e8c\u6574\u5408"},t=void 0,a={id:"ci",title:"\u6301\u7e8c\u6574\u5408",description:"\u7c21\u4ecb",source:"@site/versioned_docs/version-stable/ci.mdx",sourceDirName:".",slug:"/ci",permalink:"/docs/ci",draft:!1,unlisted:!1,tags:[],version:"stable",frontMatter:{id:"ci",title:"\u6301\u7e8c\u6574\u5408"},sidebar:"docs",previous:{title:"Docker",permalink:"/docs/docker"},next:{title:"Selenium Grid (\u5be6\u9a57\u6027)",permalink:"/docs/selenium-grid"}},c={},d=[{value:"\u7c21\u4ecb",id:"\u7c21\u4ecb",level:2},{value:"Workers",id:"workers",level:2},{value:"CI configurations",id:"ci-configurations",level:2},{value:"GitHub Actions",id:"github-actions",level:3},{value:"\u5728 push/pull_request",id:"\u5728-pushpull_request",level:4},{value:"On push/pull_request (sharded)",id:"on-pushpull_request-sharded",level:4},{value:"\u901a\u904e\u5bb9\u5668",id:"\u901a\u904e\u5bb9\u5668",level:4},{value:"\u90e8\u7f72",id:"\u90e8\u7f72",level:4},{value:"\u5feb\u901f\u5931\u6557",id:"\u5feb\u901f\u5931\u6557",level:4},{value:"Docker",id:"docker",level:3},{value:"Azure Pipelines",id:"azure-pipelines",level:3},{value:"\u4f7f\u7528 Azure Pipelines \u4e0a\u50b3 playwright-report \u8cc7\u6599\u593e",id:"\u4f7f\u7528-azure-pipelines-\u4e0a\u50b3-playwright-report-\u8cc7\u6599\u593e",level:4},{value:"Azure Pipelines (sharded)",id:"azure-pipelines-sharded",level:4},{value:"Azure Pipelines (containerized)",id:"azure-pipelines-containerized",level:4},{value:"CircleCI",id:"circleci",level:3},{value:"\u5728 CircleCI \u4e2d\u5206\u7247",id:"\u5728-circleci-\u4e2d\u5206\u7247",level:4},{value:"Jenkins",id:"jenkins",level:3},{value:"Bitbucket Pipelines",id:"bitbucket-pipelines",level:3},{value:"GitLab CI",id:"gitlab-ci",level:3},{value:"\u5206\u7247",id:"\u5206\u7247",level:4},{value:"Google Cloud Build",id:"google-cloud-build",level:3},{value:"Drone",id:"drone",level:3},{value:"\u5feb\u53d6\u700f\u89bd\u5668",id:"\u5feb\u53d6\u700f\u89bd\u5668",level:2},{value:"\u5075\u932f\u700f\u89bd\u5668\u555f\u52d5",id:"\u5075\u932f\u700f\u89bd\u5668\u555f\u52d5",level:2},{value:"\u57f7\u884c\u6709\u982d\u700f\u89bd\u5668 (Running headed)",id:"\u57f7\u884c\u6709\u982d\u700f\u89bd\u5668-running-headed",level:2}];function o(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"\u7c21\u4ecb",children:"\u7c21\u4ecb"}),"\n",(0,i.jsx)(n.p,{children:"Playwright \u6e2c\u8a66\u53ef\u4ee5\u5728 CI \u74b0\u5883\u4e2d\u57f7\u884c\u3002\u6211\u5011\u5df2\u7d93\u70ba\u5e38\u898b\u7684 CI \u63d0\u4f9b\u8005\u5efa\u7acb\u4e86\u7bc4\u4f8b\u914d\u7f6e\u3002"}),"\n",(0,i.jsx)(n.p,{children:"3 \u6b65\u9a5f\u8b93\u4f60\u7684\u6e2c\u8a66\u5728 CI \u4e0a\u57f7\u884c:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u78ba\u4fdd CI \u4ee3\u7406\u53ef\u4ee5\u57f7\u884c\u700f\u89bd\u5668"}),": \u4f7f\u7528 ",(0,i.jsx)(n.a,{href:"/docs/docker",children:"\u6211\u5011\u7684 Docker \u6620\u50cf"})," \u5728 Linux \u4ee3\u7406\u4e2d\u6216\u4f7f\u7528 ",(0,i.jsx)(n.a,{href:"./browsers#install-system-dependencies",children:"CLI"})," \u5b89\u88dd\u4f60\u7684\u76f8\u4f9d\u5957\u4ef6\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5b89\u88dd Playwright"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u5b89\u88dd NPM \u5957\u4ef6\nnpm ci\n\n# \u5b89\u88dd Playwright \u700f\u89bd\u5668\u548c\u76f8\u4f9d\u5957\u4ef6\nnpx playwright install --with-deps\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u57f7\u884c\u4f60\u7684\u6e2c\u8a66"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npx playwright test\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"workers",children:"Workers"}),"\n",(0,i.jsxs)(n.p,{children:["\u6211\u5011\u5efa\u8b70\u5728 CI \u74b0\u5883\u4e2d\u5c07 ",(0,i.jsx)(n.a,{href:"/docs/api/class-testconfig#test-config-workers",children:"workers"}),' \u8a2d\u5b9a\u70ba "1" \u4ee5\u512a\u5148\u8003\u616e\u7a69\u5b9a\u6027\u548c\u53ef\u91cd\u73fe\u6027\u3002\u9806\u5e8f\u57f7\u884c\u6e2c\u8a66\u53ef\u78ba\u4fdd\u6bcf\u500b\u6e2c\u8a66\u7372\u5f97\u5b8c\u6574\u7684\u7cfb\u7d71\u8cc7\u6e90\uff0c\u907f\u514d\u6f5b\u5728\u7684\u885d\u7a81\u3002\u7136\u800c\uff0c\u5982\u679c\u60a8\u6709\u5f37\u5927\u7684\u81ea\u8a17\u7ba1 CI \u7cfb\u7d71\uff0c\u60a8\u53ef\u4ee5\u555f\u7528 ',(0,i.jsx)(n.a,{href:"/docs/test-parallel",children:"parallel"})," \u6e2c\u8a66\u3002\u5c0d\u65bc\u66f4\u5ee3\u6cdb\u7684\u5e73\u884c\u5316\uff0c\u8003\u616e ",(0,i.jsx)(n.a,{href:"/docs/test-parallel#shard-tests-between-multiple-machines",children:"sharding"})," - \u5c07\u6e2c\u8a66\u5206\u4f48\u5728\u591a\u500b CI \u4efb\u52d9\u4e2d\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title="playwright.config.ts"',children:"import { defineConfig, devices } from '@playwright/test';\n\nexport default defineConfig({\n  // Opt out of parallel tests on CI.\n  workers: process.env.CI ? 1 : undefined,\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"ci-configurations",children:"CI configurations"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"./browsers#install-system-dependencies",children:"\u547d\u4ee4\u5217\u5de5\u5177"})," \u53ef\u4ee5\u7528\u4f86\u5728 CI \u4e2d\u5b89\u88dd\u6240\u6709\u4f5c\u696d\u7cfb\u7d71\u76f8\u4f9d\u5957\u4ef6\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"github-actions",children:"GitHub Actions"}),"\n",(0,i.jsx)(n.h4,{id:"\u5728-pushpull_request",children:"\u5728 push/pull_request"}),"\n",(0,i.jsxs)(n.p,{children:["\u6e2c\u8a66\u5c07\u5728\u63a8\u9001\u6216\u62c9\u53d6\u8acb\u6c42\u81f3 main/master \u5206\u652f\u6642\u57f7\u884c\u3002 ",(0,i.jsx)(n.a,{href:"https://docs.github.com/en/actions/using-workflows/about-workflows",children:"\u5de5\u4f5c\u6d41\u7a0b"})," \u6703\u5b89\u88dd\u6240\u6709\u76f8\u4f9d\u5957\u4ef6\uff0c\u5b89\u88dd Playwright\uff0c\u7136\u5f8c\u57f7\u884c\u6e2c\u8a66\u3002\u5b83\u9084\u6703\u5efa\u7acb HTML \u5831\u544a\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",metastring:'title=".github/workflows/playwright.yml"',children:"name: Playwright Tests\non:\n  push:\n    branches: [ main, master ]\n  pull_request:\n    branches: [ main, master ]\njobs:\n  test:\n    timeout-minutes: 60\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v4\n    - uses: actions/setup-node@v4\n      with:\n        node-version: 18\n    - name: Install dependencies\n      run: npm ci\n    - name: Install Playwright Browsers\n      run: npx playwright install --with-deps\n    - name: Run Playwright tests\n      run: npx playwright test\n    - uses: actions/upload-artifact@v4\n      if: ${{ !cancelled() }}\n      with:\n        name: playwright-report\n        path: playwright-report/\n        retention-days: 30\n"})}),"\n",(0,i.jsx)(n.h4,{id:"on-pushpull_request-sharded",children:"On push/pull_request (sharded)"}),"\n",(0,i.jsxs)(n.p,{children:["GitHub Actions \u652f\u63f4",(0,i.jsx)(n.a,{href:"https://docs.github.com/en/actions/using-jobs/using-a-matrix-for-your-jobs",children:"\u5728\u591a\u500b\u5de5\u4f5c\u4e4b\u9593\u5206\u7247\u6e2c\u8a66"}),"\u3002\u67e5\u770b\u6211\u5011\u7684",(0,i.jsx)(n.a,{href:"./test-sharding",children:"\u5206\u7247\u6587\u4ef6"}),"\u4ee5\u4e86\u89e3\u66f4\u591a\u95dc\u65bc\u5206\u7247\u7684\u8cc7\u8a0a\uff0c\u4e26\u67e5\u770b\u5982\u4f55\u914d\u7f6e\u5de5\u4f5c\u4ee5\u5728\u591a\u53f0\u6a5f\u5668\u4e0a\u57f7\u884c\u6e2c\u8a66\u4ee5\u53ca\u5982\u4f55\u5408\u4f75 HTML \u5831\u544a\u7684",(0,i.jsx)(n.a,{href:"/docs/test-sharding#github-actions-example",children:"GitHub actions \u7bc4\u4f8b"}),"\u3002"]}),"\n",(0,i.jsx)(n.h4,{id:"\u901a\u904e\u5bb9\u5668",children:"\u901a\u904e\u5bb9\u5668"}),"\n",(0,i.jsxs)(n.p,{children:["GitHub Actions \u652f\u63f4",(0,i.jsx)(n.a,{href:"https://docs.github.com/en/actions/using-jobs/running-jobs-in-a-container",children:"\u5728\u5bb9\u5668\u4e2d\u57f7\u884c\u4f5c\u696d"}),"\uff0c\u4f7f\u7528",(0,i.jsx)(n.a,{href:"https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idcontainer",children:(0,i.jsx)(n.code,{children:"jobs.<job_id>.container"})}),"\u9078\u9805\u3002\u9019\u5c0d\u65bc\u4e0d\u6c61\u67d3\u4e3b\u6a5f\u74b0\u5883\u8207\u76f8\u4f9d\u5957\u4ef6\u4e26\u5728\u4e0d\u540c\u4f5c\u696d\u7cfb\u7d71\u4e2d\u9032\u884c\u4e00\u81f4\u7684\u74b0\u5883\uff0c\u4f8b\u5982\u622a\u5716/\u8996\u89ba\u56de\u6b78\u6e2c\u8a66\uff0c\u975e\u5e38\u6709\u7528\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",metastring:'title=".github/workflows/playwright.yml"',children:"name: Playwright Tests\non:\n  push:\n    branches: [ main, master ]\n  pull_request:\n    branches: [ main, master ]\njobs:\n  playwright:\n    name: 'Playwright Tests'\n    runs-on: ubuntu-latest\n    container:\n      image: mcr.microsoft.com/playwright:v1.47.0-jammy\n    steps:\n      - uses: actions/checkout@v4\n      - uses: actions/setup-node@v4\n        with:\n          node-version: 18\n      - name: Install dependencies\n        run: npm ci\n      - name: Run your tests\n        run: npx playwright test\n        env:\n          HOME: /root\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u90e8\u7f72",children:"\u90e8\u7f72"}),"\n",(0,i.jsxs)(n.p,{children:["\u9019\u5c07\u5728 ",(0,i.jsx)(n.a,{href:"https://developer.github.com/v3/repos/deployments/",children:"GitHub Deployment"})," \u9032\u5165 ",(0,i.jsx)(n.code,{children:"success"})," \u72c0\u614b\u5f8c\u958b\u59cb\u6e2c\u8a66\u3002\u50cf Vercel \u9019\u6a23\u7684\u670d\u52d9\u4f7f\u7528\u9019\u7a2e\u6a21\u5f0f\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u5728\u4ed6\u5011\u90e8\u7f72\u7684\u74b0\u5883\u4e2d\u57f7\u884c\u7aef\u5230\u7aef\u6e2c\u8a66\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",metastring:'title=".github/workflows/playwright.yml"',children:"name: Playwright Tests\non:\n  deployment_status:\njobs:\n  test:\n    timeout-minutes: 60\n    runs-on: ubuntu-latest\n    if: github.event.deployment_status.state == 'success'\n    steps:\n    - uses: actions/checkout@v4\n    - uses: actions/setup-node@v4\n      with:\n        node-version: 18\n    - name: Install dependencies\n      run: npm ci\n    - name: Install Playwright\n      run: npx playwright install --with-deps\n    - name: Run Playwright tests\n      run: npx playwright test\n      env:\n        PLAYWRIGHT_TEST_BASE_URL: ${{ github.event.deployment_status.target_url }}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u5feb\u901f\u5931\u6557",children:"\u5feb\u901f\u5931\u6557"}),"\n",(0,i.jsxs)(n.p,{children:["\u5927\u578b\u6e2c\u8a66\u5957\u4ef6\u53ef\u80fd\u9700\u8981\u5f88\u9577\u6642\u9593\u624d\u80fd\u57f7\u884c\u3002\u901a\u904e\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"--only-changed"})," \u65d7\u6a19\u57f7\u884c\u521d\u6b65\u6e2c\u8a66\u904b\u884c\uff0c\u4f60\u53ef\u4ee5\u5148\u57f7\u884c\u53ef\u80fd\u6703\u5931\u6557\u7684\u6e2c\u8a66\u6587\u4ef6\u3002\u9019\u5c07\u70ba\u4f60\u63d0\u4f9b\u66f4\u5feb\u7684\u53cd\u994b\u8ff4\u5708\uff0c\u4e26\u5728\u8655\u7406 Pull Requests \u6642\u7565\u5fae\u964d\u4f4e CI \u6d88\u8017\u3002\u70ba\u4e86\u6aa2\u6e2c\u53d7\u4f60\u7684\u66f4\u6539\u96c6\u5f71\u97ff\u7684\u6e2c\u8a66\u6587\u4ef6\uff0c",(0,i.jsx)(n.code,{children:"--only-changed"})," \u6703\u5206\u6790\u4f60\u7684\u5957\u4ef6\u7684\u76f8\u4f9d\u5716\u3002\u9019\u662f\u4e00\u7a2e\u555f\u767c\u5f0f\u65b9\u6cd5\uff0c\u53ef\u80fd\u6703\u6f0f\u6389\u4e00\u4e9b\u6e2c\u8a66\uff0c\u56e0\u6b64\u5728\u521d\u6b65\u6e2c\u8a66\u904b\u884c\u5f8c\uff0c\u59cb\u7d42\u57f7\u884c\u5b8c\u6574\u7684\u6e2c\u8a66\u5957\u4ef6\u662f\u5f88\u91cd\u8981\u7684\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"name: Playwright Tests\non:\n  push:\n    branches: [ main, master ]\n  pull_request:\n    branches: [ main, master ]\njobs:\n  test:\n    timeout-minutes: 60\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v4\n      with:\n        # Force a non-shallow checkout, so that we can reference $GITHUB_BASE_REF.\n        # See https://github.com/actions/checkout for more details.\n        fetch-depth: 0\n    - uses: actions/setup-node@v4\n      with:\n        node-version: 18\n    - name: Install dependencies\n      run: npm ci\n    - name: Install Playwright Browsers\n      run: npx playwright install --with-deps\n    - name: Run changed Playwright tests\n      run: npx playwright test --only-changed=$GITHUB_BASE_REF\n      if: github.event_name == 'pull_request'\n    - name: Run Playwright tests\n      run: npx playwright test\n    - uses: actions/upload-artifact@v4\n      if: ${{ !cancelled() }}\n      with:\n        name: playwright-report\n        path: playwright-report/\n        retention-days: 30\n"})}),"\n",(0,i.jsx)(n.h3,{id:"docker",children:"Docker"}),"\n",(0,i.jsxs)(n.p,{children:["\u6211\u5011\u6709\u4e00\u500b",(0,i.jsx)(n.a,{href:"/docs/docker",children:"\u9810\u5efa\u7684 Docker \u6620\u50cf"}),"\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\uff0c\u6216\u4f5c\u70ba\u66f4\u65b0\u73fe\u6709 Docker \u5b9a\u7fa9\u7684\u53c3\u8003\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u5efa\u8b70\u7684\u8a2d\u5b9a"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\u7576\u4f7f\u7528 Chromium \u6642\uff0c\u4e5f\u5efa\u8b70\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"--ipc=host"}),"\u3002\u5426\u5247 Chromium \u53ef\u80fd\u6703\u8017\u76e1\u8a18\u61b6\u9ad4\u4e26\u5d29\u6f70\u3002\u4e86\u89e3\u66f4\u591a\u95dc\u65bc\u6b64\u9078\u9805\u7684\u8cc7\u8a0a\u5728 ",(0,i.jsx)(n.a,{href:"https://docs.docker.com/engine/reference/run/#ipc-settings---ipc",children:"Docker docs"}),"\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:["\u555f\u52d5 Chromium \u6642\u770b\u5230\u5176\u4ed6\u5947\u602a\u7684\u932f\u8aa4\uff1f\u5617\u8a66\u5728\u672c\u5730\u958b\u767c\u6642\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"docker run --cap-add=SYS_ADMIN"})," \u57f7\u884c\u5bb9\u5668\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5efa\u8b70\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"--init"})," Docker \u65d7\u6a19\u6216 ",(0,i.jsx)(n.a,{href:"https://github.com/Yelp/dumb-init",children:"dumb-init"})," \u4f86\u907f\u514d\u5c0d PID=1 \u7684\u7a0b\u5e8f\u9032\u884c\u7279\u6b8a\u8655\u7406\u3002\u9019\u662f\u6bad\u5c4d\u7a0b\u5e8f\u7684\u4e00\u500b\u5e38\u898b\u539f\u56e0\u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"azure-pipelines",children:"Azure Pipelines"}),"\n",(0,i.jsx)(n.p,{children:"\u5c0d\u65bc Windows \u6216 macOS \u4ee3\u7406\uff0c\u4e0d\u9700\u8981\u984d\u5916\u7684\u914d\u7f6e\uff0c\u53ea\u9700\u5b89\u88dd Playwright \u4e26\u57f7\u884c\u60a8\u7684\u6e2c\u8a66\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u5c0d\u65bc Linux \u4ee3\u7406\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528",(0,i.jsx)(n.a,{href:"/docs/docker",children:"\u6211\u5011\u7684 Docker \u5bb9\u5668"}),"\u8207 Azure Pipelines \u652f\u63f4",(0,i.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/devops/pipelines/process/container-phases?view=azure-devops",children:"\u57f7\u884c\u5bb9\u5668\u5316\u7684\u4f5c\u696d"}),"\u3002\u6216\u8005\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528",(0,i.jsx)(n.a,{href:"./browsers#install-system-dependencies",children:"\u547d\u4ee4\u5217\u5de5\u5177"}),"\u4f86\u5b89\u88dd\u6240\u6709\u5fc5\u8981\u7684\u76f8\u4f9d\u5957\u4ef6\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u8981\u57f7\u884c Playwright \u6e2c\u8a66\uff0c\u8acb\u4f7f\u7528\u6b64\u7ba1\u9053\u4efb\u52d9:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"trigger:\n- main\n\npool:\n  vmImage: ubuntu-latest\n\nsteps:\n- task: NodeTool@0\n  inputs:\n    versionSpec: '18'\n  displayName: 'Install Node.js'\n- script: npm ci\n  displayName: 'npm ci'\n- script: npx playwright install --with-deps\n  displayName: 'Install Playwright browsers'\n- script: npx playwright test\n  displayName: 'Run Playwright tests'\n  env:\n    CI: 'true'\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u4f7f\u7528-azure-pipelines-\u4e0a\u50b3-playwright-report-\u8cc7\u6599\u593e",children:"\u4f7f\u7528 Azure Pipelines \u4e0a\u50b3 playwright-report \u8cc7\u6599\u593e"}),"\n",(0,i.jsxs)(n.p,{children:["\u9019\u5c07\u4f7f\u7ba1\u9053\u57f7\u884c\u5931\u6557\uff0c\u5982\u679c\u4efb\u4f55 Playwright \u6e2c\u8a66\u5931\u6557\u3002\u5982\u679c\u4f60\u9084\u60f3\u5c07\u6e2c\u8a66\u7d50\u679c\u8207 Azure DevOps \u6574\u5408\uff0c\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"PublishTestResults"})," \u4efb\u52d9\uff0c\u5982\u4e0b\u6240\u793a:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"trigger:\n- main\n\npool:\n  vmImage: ubuntu-latest\n\nsteps:\n- task: NodeTool@0\n  inputs:\n    versionSpec: '18'\n  displayName: 'Install Node.js'\n\n- script: npm ci\n  displayName: 'npm ci'\n- script: npx playwright install --with-deps\n  displayName: 'Install Playwright browsers'\n- script: npx playwright test\n  displayName: 'Run Playwright tests'\n  env:\n    CI: 'true'\n- task: PublishTestResults@2\n  displayName: 'Publish test results'\n  inputs:\n    searchFolder: 'test-results'\n    testResultsFormat: 'JUnit'\n    testResultsFiles: 'e2e-junit-results.xml'\n    mergeTestResults: true\n    failTaskOnFailedTests: true\n    testRunTitle: 'My End-To-End Tests'\n  condition: succeededOrFailed()\n- task: PublishPipelineArtifact@1\n  inputs:\n    targetPath: playwright-report\n    artifact: playwright-report\n    publishLocation: 'pipeline'\n  condition: succeededOrFailed()\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u6ce8\u610f: JUnit reporter \u9700\u8981\u901a\u904e\u4ee5\u4e0b\u65b9\u5f0f\u9032\u884c\u76f8\u61c9\u914d\u7f6e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"import { defineConfig } from '@playwright/test';\n\nexport default defineConfig({\n  reporter: [['junit', { outputFile: 'test-results/e2e-junit-results.xml' }]],\n});\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u5728 ",(0,i.jsx)(n.code,{children:"playwright.config.ts"}),"\u3002"]}),"\n",(0,i.jsx)(n.h4,{id:"azure-pipelines-sharded",children:"Azure Pipelines (sharded)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"trigger:\n- main\n\npool:\n  vmImage: ubuntu-latest\n\nstrategy:\n  matrix:\n    chromium-1:\n      project: chromium\n      shard: 1/3\n    chromium-2:\n      project: chromium\n      shard: 2/3\n    chromium-3:\n      project: chromium\n      shard: 3/3\n    firefox-1:\n      project: firefox\n      shard: 1/3\n    firefox-2:\n      project: firefox\n      shard: 2/3\n    firefox-3:\n      project: firefox\n      shard: 3/3\n    webkit-1:\n      project: webkit\n      shard: 1/3\n    webkit-2:\n      project: webkit\n      shard: 2/3\n    webkit-3:\n      project: webkit\n      shard: 3/3\nsteps:\n- task: NodeTool@0\n  inputs:\n    versionSpec: '18'\n  displayName: 'Install Node.js'\n\n- script: npm ci\n  displayName: 'npm ci'\n- script: npx playwright install --with-deps\n  displayName: 'Install Playwright browsers'\n- script: npx playwright test --project=$(project) --shard=$(shard)\n  displayName: 'Run Playwright tests'\n  env:\n    CI: 'true'\n"})}),"\n",(0,i.jsx)(n.h4,{id:"azure-pipelines-containerized",children:"Azure Pipelines (containerized)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"trigger:\n- main\n\npool:\n  vmImage: ubuntu-latest\ncontainer: mcr.microsoft.com/playwright:v1.47.0-noble\n\nsteps:\n- task: NodeTool@0\n  inputs:\n    versionSpec: '18'\n  displayName: 'Install Node.js'\n\n- script: npm ci\n  displayName: 'npm ci'\n- script: npx playwright test\n  displayName: 'Run Playwright tests'\n  env:\n    CI: 'true'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"circleci",children:"CircleCI"}),"\n",(0,i.jsxs)(n.p,{children:["\u57f7\u884c Playwright \u5728 CircleCI \u4e0a\u8207\u5728 GitHub Actions \u4e0a\u975e\u5e38\u76f8\u4f3c\u3002\u70ba\u4e86\u6307\u5b9a\u9810\u5efa\u7684 Playwright ",(0,i.jsx)(n.a,{href:"/docs/docker",children:"Docker image"}),"\uff0c\u53ea\u9700\u5728\u4f60\u7684\u914d\u7f6e\u4e2d\u7528 ",(0,i.jsx)(n.code,{children:"docker:"})," \u4fee\u6539\u4ee3\u7406\u5b9a\u7fa9\uff0c\u5982\u4e0b\u6240\u793a:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"executors:\n  pw-jammy-development:\n    docker:\n      - image: mcr.microsoft.com/playwright:v1.47.0-noble\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u6ce8\u610f: \u7576\u4f7f\u7528 docker \u4ee3\u7406\u5b9a\u7fa9\u6642\uff0c\u4f60\u6b63\u5728\u5c07 Playwright \u57f7\u884c\u7684\u8cc7\u6e90\u985e\u5225\u6307\u5b9a\u70ba 'medium' \u7d1a\u5225 ",(0,i.jsx)(n.a,{href:"https://circleci.com/docs/configuration-reference?#docker-execution-environment",children:"\u6b64\u8655"}),"\u3002Playwright \u7684\u9810\u8a2d\u884c\u70ba\u662f\u5c07\u5de5\u4f5c\u8005\u6578\u91cf\u8a2d\u7f6e\u70ba\u6aa2\u6e2c\u5230\u7684\u6838\u5fc3\u6578\u91cf\uff08\u5728 medium \u7d1a\u5225\u7684\u60c5\u6cc1\u4e0b\u70ba 2\uff09\u3002\u5c07\u5de5\u4f5c\u8005\u6578\u91cf\u8986\u84cb\u8a2d\u5b9a\u70ba\u5927\u65bc\u9019\u500b\u6578\u5b57\u5c07\u5c0e\u81f4\u4e0d\u5fc5\u8981\u7684\u8d85\u6642\u548c\u5931\u6557\u3002"]}),"\n",(0,i.jsx)(n.h4,{id:"\u5728-circleci-\u4e2d\u5206\u7247",children:"\u5728 CircleCI \u4e2d\u5206\u7247"}),"\n",(0,i.jsxs)(n.p,{children:["\u5728 CircleCI \u4e2d\u7684\u5206\u7247\u662f\u5f9e 0 \u958b\u59cb\u7d22\u5f15\u7684\uff0c\u9019\u610f\u5473\u8457\u4f60\u9700\u8981\u8986\u5beb\u9810\u8a2d\u7684\u5e73\u884c\u8655\u7406\u74b0\u5883\u8b8a\u6578\u3002\u4ee5\u4e0b\u7bc4\u4f8b\u5c55\u793a\u4e86\u5982\u4f55\u901a\u904e\u5c07 ",(0,i.jsx)(n.code,{children:"CIRCLE_NODE_INDEX"})," \u52a0 1 \u4f86\u50b3\u905e\u5230 ",(0,i.jsx)(n.code,{children:"--shard"})," cli \u53c3\u6578\uff0c\u4ee5 4 \u7684 CircleCI \u5e73\u884c\u8655\u7406\u57f7\u884c Playwright\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:'  playwright-job-name:\n    executor: pw-jammy-development\n    parallelism: 4\n    steps:\n      - run: SHARD="$((${CIRCLE_NODE_INDEX}+1))"; npx playwright test -- --shard=${SHARD}/${CIRCLE_NODE_TOTAL}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"jenkins",children:"Jenkins"}),"\n",(0,i.jsxs)(n.p,{children:["Jenkins \u652f\u63f4 Docker \u4ee3\u7406\u7528\u65bc\u7ba1\u7dda\u3002\u4f7f\u7528 ",(0,i.jsx)(n.a,{href:"/docs/docker",children:"Playwright Docker \u6620\u50cf"})," \u5728 Jenkins \u4e0a\u57f7\u884c\u6e2c\u8a66\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-groovy",children:"pipeline {\n   agent { docker { image 'mcr.microsoft.com/playwright:v1.47.0-noble' } }\n   stages {\n      stage('e2e-tests') {\n         steps {\n            sh 'npm ci'\n            sh 'npx playwright test'\n         }\n      }\n   }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"bitbucket-pipelines",children:"Bitbucket Pipelines"}),"\n",(0,i.jsxs)(n.p,{children:["Bitbucket Pipelines \u53ef\u4ee5\u4f7f\u7528\u516c\u5171 ",(0,i.jsx)(n.a,{href:"https://confluence.atlassian.com/bitbucket/use-docker-images-as-build-environments-792298897.html",children:"Docker images as build environments"}),"\u3002\u8981\u5728 Bitbucket \u4e0a\u57f7\u884c Playwright \u6e2c\u8a66\uff0c\u8acb\u4f7f\u7528\u6211\u5011\u7684\u516c\u5171 Docker image (",(0,i.jsx)(n.a,{href:"/docs/docker",children:"see Dockerfile"}),")\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"image: mcr.microsoft.com/playwright:v1.47.0-noble\n"})}),"\n",(0,i.jsx)(n.h3,{id:"gitlab-ci",children:"GitLab CI"}),"\n",(0,i.jsxs)(n.p,{children:["\u8981\u5728 GitLab \u4e0a\u57f7\u884c Playwright \u6e2c\u8a66\uff0c\u8acb\u4f7f\u7528\u6211\u5011\u7684\u516c\u5171 Docker \u6620\u50cf(",(0,i.jsx)(n.a,{href:"/docs/docker",children:"see Dockerfile"}),")\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"stages:\n  - test\n\ntests:\n  stage: test\n  image: mcr.microsoft.com/playwright:v1.47.0-noble\n  script:\n  ...\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u5206\u7247",children:"\u5206\u7247"}),"\n",(0,i.jsxs)(n.p,{children:["GitLab CI \u652f\u63f4\u4f7f\u7528 ",(0,i.jsx)(n.a,{href:"https://docs.gitlab.com/ee/ci/yaml/index.html#parallel",children:"parallel"})," \u95dc\u9375\u5b57 ",(0,i.jsx)(n.a,{href:"https://docs.gitlab.com/ee/ci/jobs/job_control.html#parallelize-large-jobs",children:"\u5728\u591a\u500b\u5de5\u4f5c\u4e4b\u9593\u5206\u7247\u6e2c\u8a66"}),"\u3002\u6e2c\u8a66\u5de5\u4f5c\u5c07\u88ab\u62c6\u5206\u6210\u591a\u500b\u8f03\u5c0f\u7684\u5de5\u4f5c\u4e26\u884c\u57f7\u884c\u3002\u4e26\u884c\u5de5\u4f5c\u6703\u5f9e ",(0,i.jsx)(n.code,{children:"job_name 1/N"})," \u5230 ",(0,i.jsx)(n.code,{children:"job_name N/N"})," \u9806\u5e8f\u547d\u540d\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"stages:\n  - test\n\ntests:\n  stage: test\n  image: mcr.microsoft.com/playwright:v1.47.0-noble\n  parallel: 7\n  script:\n    - npm ci\n    - npx playwright test --shard=$CI_NODE_INDEX/$CI_NODE_TOTAL\n"})}),"\n",(0,i.jsxs)(n.p,{children:["GitLab CI \u4e5f\u652f\u63f4\u4f7f\u7528 ",(0,i.jsxs)(n.a,{href:"https://docs.gitlab.com/ee/ci/yaml/index.html#parallelmatrix",children:["parallel",":matrix"]})," \u9078\u9805\u5728\u591a\u500b\u4f5c\u696d\u4e4b\u9593\u5206\u7247\u6e2c\u8a66\u3002\u6e2c\u8a66\u4f5c\u696d\u5c07\u5728\u55ae\u500b\u7ba1\u9053\u4e2d\u591a\u6b21\u5e73\u884c\u57f7\u884c\uff0c\u4f46\u6bcf\u500b\u4f5c\u696d\u5be6\u4f8b\u5177\u6709\u4e0d\u540c\u7684\u8b8a\u6578\u503c\u3002\u5728\u4e0b\u9762\u7684\u7bc4\u4f8b\u4e2d\uff0c\u6211\u5011\u6709 2 \u500b ",(0,i.jsx)(n.code,{children:"PROJECT"})," \u503c\u548c 10 \u500b ",(0,i.jsx)(n.code,{children:"SHARD"})," \u503c\uff0c\u7e3d\u5171\u9700\u8981\u57f7\u884c 20 \u500b\u4f5c\u696d\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"stages:\n  - test\n\ntests:\n  stage: test\n  image: mcr.microsoft.com/playwright:v1.47.0-noble\n  parallel:\n    matrix:\n      - PROJECT: ['chromium', 'webkit']\n        SHARD: ['1/10', '2/10', '3/10', '4/10', '5/10', '6/10', '7/10', '8/10', '9/10', '10/10']\n  script:\n    - npm ci\n    - npx playwright test --project=$PROJECT --shard=$SHARD\n"})}),"\n",(0,i.jsx)(n.h3,{id:"google-cloud-build",children:"Google Cloud Build"}),"\n",(0,i.jsxs)(n.p,{children:["\u8981\u5728 Google Cloud Build \u4e0a\u57f7\u884c Playwright \u6e2c\u8a66\uff0c\u8acb\u4f7f\u7528\u6211\u5011\u7684\u516c\u5171 Docker \u6620\u50cf(",(0,i.jsx)(n.a,{href:"/docs/docker",children:"see Dockerfile"}),")\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"steps:\n- name: mcr.microsoft.com/playwright:v1.47.0-noble\n  script:\n  ...\n  env:\n  - 'CI=true'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"drone",children:"Drone"}),"\n",(0,i.jsxs)(n.p,{children:["\u8981\u5728 Drone \u4e0a\u57f7\u884c Playwright \u6e2c\u8a66\uff0c\u8acb\u4f7f\u7528\u6211\u5011\u7684\u516c\u958b Docker \u6620\u50cf\u6a94(",(0,i.jsx)(n.a,{href:"/docs/docker",children:"see Dockerfile"}),")\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"kind: pipeline\nname: default\ntype: docker\n\nsteps:\n  - name: test\n    image: mcr.microsoft.com/playwright:v1.47.0-jammy\n    commands:\n      - npx playwright test\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u5feb\u53d6\u700f\u89bd\u5668",children:"\u5feb\u53d6\u700f\u89bd\u5668"}),"\n",(0,i.jsxs)(n.p,{children:["\u5feb\u53d6\u700f\u89bd\u5668\u4e8c\u9032\u4f4d\u6a94\u6848\u4e26\u4e0d\u5efa\u8b70\uff0c\u56e0\u70ba\u9084\u539f\u5feb\u53d6\u6240\u9700\u7684\u6642\u9593\u8207\u4e0b\u8f09\u4e8c\u9032\u4f4d\u6a94\u6848\u6240\u9700\u7684\u6642\u9593\u76f8\u7576\u3002\u7279\u5225\u662f\u5728 Linux \u4e0b\uff0c\u9700\u8981\u5b89\u88dd",(0,i.jsx)(n.a,{href:"/docs/browsers#install-system-dependencies",children:"\u4f5c\u696d\u7cfb\u7d71\u76f8\u4f9d\u5957\u4ef6"}),"\uff0c\u9019\u4e9b\u662f\u7121\u6cd5\u5feb\u53d6\u7684\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u5982\u679c\u4f60\u4ecd\u7136\u60f3\u5728 CI \u57f7\u884c\u4e4b\u9593\u5feb\u53d6\u700f\u89bd\u5668\u4e8c\u9032\u4f4d\u6a94\uff0c\u8acb\u5728\u4f60\u7684 CI \u8a2d\u5b9a\u4e2d\uff0c\u6839\u64da Playwright \u7248\u672c\u7684\u96dc\u6e4a\u503c\u5feb\u53d6",(0,i.jsx)(n.a,{href:"/docs/browsers#managing-browser-binaries",children:"\u9019\u4e9b\u76ee\u9304"}),"\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"\u5075\u932f\u700f\u89bd\u5668\u555f\u52d5",children:"\u5075\u932f\u700f\u89bd\u5668\u555f\u52d5"}),"\n",(0,i.jsxs)(n.p,{children:["Playwright \u652f\u63f4 ",(0,i.jsx)(n.code,{children:"DEBUG"})," \u74b0\u5883\u8b8a\u6578\u4f86\u5728\u57f7\u884c\u671f\u9593\u8f38\u51fa\u9664\u932f\u65e5\u8a8c\u3002\u5c07\u5176\u8a2d\u7f6e\u70ba ",(0,i.jsx)(n.code,{children:"pw:browser"})," \u5728\u9664\u932f ",(0,i.jsx)(n.code,{children:"Error: Failed to launch browser"})," \u932f\u8aa4\u6642\u975e\u5e38\u6709\u5e6b\u52a9\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"DEBUG=pw:browser npx playwright test\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u57f7\u884c\u6709\u982d\u700f\u89bd\u5668-running-headed",children:"\u57f7\u884c\u6709\u982d\u700f\u89bd\u5668 (Running headed)"}),"\n",(0,i.jsxs)(n.p,{children:["\u9810\u8a2d\u60c5\u6cc1\u4e0b\uff0cPlaywright \u6703\u5728\u7121\u982d\u6a21\u5f0f\u4e0b\u555f\u52d5\u700f\u89bd\u5668\u3002\u8acb\u53c3\u95b1\u6211\u5011\u7684",(0,i.jsx)(n.a,{href:"/docs/running-tests#run-tests-in-headed-mode",children:"\u57f7\u884c\u6e2c\u8a66"}),"\u6307\u5357\uff0c\u4e86\u89e3\u5982\u4f55\u5728\u6709\u982d\u6a21\u5f0f\u4e0b\u57f7\u884c\u6e2c\u8a66\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u5728 Linux \u4ee3\u7406\u4e0a\uff0c\u5e36\u982d\u57f7\u884c\u9700\u8981\u5b89\u88dd ",(0,i.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Xvfb",children:"Xvfb"}),"\u3002\u6211\u5011\u7684 ",(0,i.jsx)(n.a,{href:"/docs/docker",children:"Docker image"})," \u548c GitHub Action \u5df2\u7d93\u9810\u5148\u5b89\u88dd\u4e86 Xvfb\u3002\u8981\u5728\u5e36\u982d\u6a21\u5f0f\u4e0b\u4f7f\u7528 Xvfb \u57f7\u884c\u700f\u89bd\u5668\uff0c\u8acb\u5728\u5be6\u969b\u547d\u4ee4\u524d\u6dfb\u52a0 ",(0,i.jsx)(n.code,{children:"xvfb-run"}),"\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"xvfb-run npx playwright test\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}}}]);