"use strict";(self.webpackChunkplaywright_dev=self.webpackChunkplaywright_dev||[]).push([[511],{1295:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>c,metadata:()=>o,toc:()=>a});var n=s(4848),t=s(8453);s(4235),s(8328),s(3078);const c={id:"service-workers-experimental",title:"(\u5be6\u9a57\u6027) Service Worker \u7db2\u8def\u4e8b\u4ef6"},i=void 0,o={id:"service-workers-experimental",title:"(\u5be6\u9a57\u6027) Service Worker \u7db2\u8def\u4e8b\u4ef6",description:"\u7c21\u4ecb",source:"@site/versioned_docs/version-stable/service-workers-experimental-network-events.mdx",sourceDirName:".",slug:"/service-workers-experimental",permalink:"/docs/service-workers-experimental",draft:!1,unlisted:!1,tags:[],version:"stable",frontMatter:{id:"service-workers-experimental",title:"(\u5be6\u9a57\u6027) Service Worker \u7db2\u8def\u4e8b\u4ef6"}},d={},a=[{value:"\u7c21\u4ecb",id:"\u7c21\u4ecb",level:2},{value:"\u5982\u4f55\u555f\u7528",id:"\u5982\u4f55\u555f\u7528",level:2},{value:"\u670d\u52d9\u5de5\u4f5c\u8005\u6293\u53d6",id:"\u670d\u52d9\u5de5\u4f5c\u8005\u6293\u53d6",level:2},{value:"\u5b58\u53d6 Service Workers \u548c\u7b49\u5f85\u555f\u52d5",id:"\u5b58\u53d6-service-workers-\u548c\u7b49\u5f85\u555f\u52d5",level:3},{value:"\u7db2\u8def\u4e8b\u4ef6\u548c\u8def\u7531",id:"\u7db2\u8def\u4e8b\u4ef6\u548c\u8def\u7531",level:3},{value:"\u9ad8\u7d1a\u7bc4\u4f8b",id:"\u9ad8\u7d1a\u7bc4\u4f8b",level:4},{value:"\u50c5\u8def\u7531\u670d\u52d9\u5de5\u4f5c\u8005\u8acb\u6c42",id:"\u50c5\u8def\u7531\u670d\u52d9\u5de5\u4f5c\u8005\u8acb\u6c42",level:2},{value:"\u5df2\u77e5\u9650\u5236",id:"\u5df2\u77e5\u9650\u5236",level:2}];function l(e){const r={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.h2,{id:"\u7c21\u4ecb",children:"\u7c21\u4ecb"}),"\n",(0,n.jsx)(r.admonition,{type:"warning",children:(0,n.jsxs)(r.p,{children:["\u5982\u679c\u4f60\u6b63\u5728\u5c0b\u627e\u4e00\u822c\u7684\u7db2\u8def\u6a21\u64ec\u3001\u8def\u7531\u548c\u6514\u622a\uff0c\u8acb\u5148\u53c3\u95b1 ",(0,n.jsx)(r.a,{href:"/docs/network",children:"Network Guide"}),"\u3002Playwright \u63d0\u4f9b\u5167\u5efa\u7684 API \u7528\u65bc\u6b64\u7528\u9014\uff0c\u4e0d\u9700\u8981\u4e0b\u9762\u7684\u8cc7\u8a0a\u3002\u7136\u800c\uff0c\u5982\u679c\u4f60\u5c0d Service Workers \u81ea\u8eab\u767c\u51fa\u7684\u8acb\u6c42\u611f\u8208\u8da3\uff0c\u8acb\u7e7c\u7e8c\u95b1\u8b80\u3002"]})}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API",children:"Service Workers"})," \u63d0\u4f9b\u4e86\u4e00\u7a2e\u700f\u89bd\u5668\u539f\u751f\u7684\u65b9\u6cd5\u4f86\u8655\u7406\u9801\u9762\u4f7f\u7528\u539f\u751f ",(0,n.jsxs)(r.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API",children:["Fetch API (",(0,n.jsx)(r.code,{children:"fetch"}),")"]})," \u6240\u767c\u51fa\u7684\u8acb\u6c42\u4ee5\u53ca\u5176\u4ed6\u7db2\u8def\u8acb\u6c42\u7684\u8cc7\u7522\uff08\u5982\u8173\u672c\u3001css \u548c\u5716\u7247\uff09\u3002"]}),"\n",(0,n.jsxs)(r.p,{children:["\u4ed6\u5011\u53ef\u4ee5\u4f5c\u70ba\u9801\u9762\u548c\u5916\u90e8\u7db2\u8def\u4e4b\u9593\u7684",(0,n.jsx)(r.strong,{children:"\u7db2\u8def\u4ee3\u7406"}),"\u4f86\u57f7\u884c\u5feb\u53d6\u908f\u8f2f\uff0c\u6216\u8005\u5982\u679c Service Worker \u6dfb\u52a0 ",(0,n.jsx)(r.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/FetchEvent#examples",children:"FetchEvent"})," \u76e3\u807d\u5668\uff0c\u5247\u53ef\u4ee5\u70ba\u7528\u6236\u63d0\u4f9b\u96e2\u7dda\u9ad4\u9a57\u3002"]}),"\n",(0,n.jsx)(r.p,{children:"\u8a31\u591a\u4f7f\u7528 Service Workers \u7684\u7db2\u7ad9\u50c5\u5c07\u5176\u7528\u4f5c\u900f\u660e\u7684\u6700\u4f73\u5316\u6280\u8853\u3002\u96d6\u7136\u7528\u6236\u53ef\u80fd\u6703\u6ce8\u610f\u5230\u66f4\u5feb\u7684\u9ad4\u9a57\uff0c\u4f46\u61c9\u7528\u7a0b\u5f0f\u7684\u5be6\u73fe\u4e26\u4e0d\u77e5\u9053\u5b83\u5011\u7684\u5b58\u5728\u3002\u555f\u7528\u6216\u672a\u555f\u7528 Service Workers \u57f7\u884c\u61c9\u7528\u7a0b\u5f0f\u5728\u529f\u80fd\u4e0a\u770b\u8d77\u4f86\u662f\u7b49\u6548\u7684\u3002"}),"\n",(0,n.jsx)(r.h2,{id:"\u5982\u4f55\u555f\u7528",children:"\u5982\u4f55\u555f\u7528"}),"\n",(0,n.jsxs)(r.p,{children:["Playwright \u7684 Service Workers \u6240\u767c\u51fa\u7684\u8acb\u6c42\u6aa2\u67e5\u548c\u8def\u7531\u662f",(0,n.jsx)(r.strong,{children:"\u5be6\u9a57\u6027"}),"\u7684\uff0c\u9810\u8a2d\u60c5\u6cc1\u4e0b\u662f\u505c\u7528\u7684\u3002"]}),"\n",(0,n.jsxs)(r.p,{children:["\u5c07 ",(0,n.jsx)(r.code,{children:"PW_EXPERIMENTAL_SERVICE_WORKER_NETWORK_EVENTS"})," \u74b0\u5883\u8b8a\u6578\u8a2d\u7f6e\u70ba ",(0,n.jsx)(r.code,{children:"1"}),"\uff08\u6216\u4efb\u4f55\u5176\u4ed6\u503c\uff09\u4ee5\u555f\u7528\u6b64\u529f\u80fd\u3002\u76ee\u524d\u50c5\u652f\u63f4 Chrome/Chromium\u3002"]}),"\n",(0,n.jsxs)(r.p,{children:["\u5982\u679c\u4f60\u6b63\u5728\u4f7f\u7528\uff08\u6216\u6709\u8208\u8da3\u4f7f\u7528\u6b64\u529f\u80fd\uff09\uff0c\u8acb\u5728",(0,n.jsx)(r.a,{href:"https://github.com/microsoft/playwright/issues/15684",children:"\u6b64\u554f\u984c"}),"\u4e0a\u7559\u8a00\u8b93\u6211\u5011\u77e5\u9053\u4f60\u7684\u4f7f\u7528\u6848\u4f8b\u3002"]}),"\n",(0,n.jsx)(r.h2,{id:"\u670d\u52d9\u5de5\u4f5c\u8005\u6293\u53d6",children:"\u670d\u52d9\u5de5\u4f5c\u8005\u6293\u53d6"}),"\n",(0,n.jsx)(r.h3,{id:"\u5b58\u53d6-service-workers-\u548c\u7b49\u5f85\u555f\u52d5",children:"\u5b58\u53d6 Service Workers \u548c\u7b49\u5f85\u555f\u52d5"}),"\n",(0,n.jsxs)(r.p,{children:["\u4f60\u53ef\u4ee5\u4f7f\u7528 ",(0,n.jsx)(r.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerContainer/register",children:"browserContext.serviceWorkers()"})," \u4f86\u5217\u51fa Service ",(0,n.jsx)(r.a,{href:"/docs/api/class-worker",title:"Worker",children:"Worker"}),"\uff0c\u6216\u8005\u5982\u679c\u4f60\u9810\u671f\u9801\u9762\u6703\u89f8\u767c\u5176",(0,n.jsx)(r.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerContainer/register",children:"\u8a3b\u518a"}),"\uff0c\u53ef\u4ee5\u7279\u5225\u76e3\u770b Service ",(0,n.jsx)(r.a,{href:"/docs/api/class-worker",title:"Worker",children:"Worker"}),"\uff1a"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-js",children:"const serviceWorkerPromise = context.waitForEvent('serviceworker');\nawait page.goto('/example-with-a-service-worker.html');\nconst serviceworker = await serviceWorkerPromise;\n"})}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-service-worker",children:"browserContext.on('serviceworker')"})," \u662f\u5728 Service Worker \u7684\u4e3b\u8173\u672c\u88ab\u8a55\u4f30",(0,n.jsx)(r.em,{children:(0,n.jsx)(r.strong,{children:"\u4e4b\u524d"})}),"\u89f8\u767c\u7684\uff0c\u6240\u4ee5\u5728\u547c\u53eb service",(0,n.jsx)(r.a,{href:"/docs/api/class-worker#worker-evaluate",children:"worker.evaluate()"})," \u4e4b\u524d\uff0c\u4f60\u61c9\u8a72\u7b49\u5f85\u5b83\u7684\u555f\u52d5\u3002"]}),"\n",(0,n.jsx)(r.p,{children:"\u7b49\u5f85 Service Worker \u88ab\u555f\u52d5\u6709\u66f4\u591a\u6163\u7528\u7684\u65b9\u6cd5\uff0c\u4f46\u4ee5\u4e0b\u662f\u4e00\u7a2e\u8207\u5be6\u4f5c\u7121\u95dc\u7684\u65b9\u6cd5:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-js",children:"await page.evaluate(async () => {\n  const registration = await window.navigator.serviceWorker.getRegistration();\n  if (registration.active?.state === 'activated')\n    return;\n  await new Promise(res =>\n    window.navigator.serviceWorker.addEventListener('controllerchange', res),\n  );\n});\n"})}),"\n",(0,n.jsx)(r.h3,{id:"\u7db2\u8def\u4e8b\u4ef6\u548c\u8def\u7531",children:"\u7db2\u8def\u4e8b\u4ef6\u548c\u8def\u7531"}),"\n",(0,n.jsxs)(r.p,{children:["\u4efb\u4f55\u7db2\u8def\u8acb\u6c42\u7531 ",(0,n.jsx)(r.strong,{children:"Service Worker"})," \u767c\u51fa\u5c07\u6703\u6709:"]}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request",children:"browserContext.on('request')"})," \u548c\u5176\u5c0d\u61c9\u7684\u4e8b\u4ef6(",(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request-finished",children:"browserContext.on('requestfinished')"})," \u548c ",(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-response",children:"browserContext.on('response')"}),", \u6216 ",(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request-failed",children:"browserContext.on('requestfailed')"}),")"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-route",children:"browserContext.route()"})," \u6703\u770b\u5230\u8a72\u8acb\u6c42"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.a,{href:"/docs/api/class-request#request-service-worker",children:"request.serviceWorker()"})," \u5c07\u88ab\u8a2d\u7f6e\u70ba Service ",(0,n.jsx)(r.a,{href:"/docs/api/class-worker",title:"Worker",children:"Worker"})," \u5be6\u4f8b, \u4e26\u4e14 ",(0,n.jsx)(r.a,{href:"/docs/api/class-request#request-frame",children:"request.frame()"})," \u5c07",(0,n.jsx)(r.strong,{children:"\u62cb\u51fa"})]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.a,{href:"/docs/api/class-response#response-from-service-worker",children:"response.fromServiceWorker()"})," \u5c07\u8fd4\u56de ",(0,n.jsx)(r.code,{children:"false"})]}),"\n"]}),"\n",(0,n.jsxs)(r.p,{children:["\u6b64\u5916\uff0c\u4efb\u4f55\u7531 ",(0,n.jsx)(r.strong,{children:"Page"}),"\uff08\u5305\u62ec\u5176\u5b50 ",(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"}),"\uff09\u767c\u51fa\u7684\u7db2\u8def\u8acb\u6c42\u5c07\u6703\u6709:"]}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request",children:"browserContext.on('request')"})," \u548c\u5176\u5c0d\u61c9\u7684\u4e8b\u4ef6(",(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request-finished",children:"browserContext.on('requestfinished')"})," \u548c ",(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-response",children:"browserContext.on('response')"}),", \u6216 ",(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request-failed",children:"browserContext.on('requestfailed')"}),")"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.a,{href:"/docs/api/class-page#page-event-request",children:"page.on('request')"})," \u548c\u5176\u5c0d\u61c9\u7684\u4e8b\u4ef6(",(0,n.jsx)(r.a,{href:"/docs/api/class-page#page-event-request-finished",children:"page.on('requestfinished')"})," \u548c ",(0,n.jsx)(r.a,{href:"/docs/api/class-page#page-event-response",children:"page.on('response')"}),", \u6216 ",(0,n.jsx)(r.a,{href:"/docs/api/class-page#page-event-request-failed",children:"page.on('requestfailed')"}),")"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.a,{href:"/docs/api/class-page#page-route",children:"page.route()"})," \u548c ",(0,n.jsx)(r.a,{href:"/docs/api/class-page#page-route",children:"page.route()"})," \u5c07",(0,n.jsx)(r.strong,{children:"\u4e0d\u6703"}),"\u770b\u5230\u8acb\u6c42(\u5982\u679c\u5df2\u8a3b\u518a\u4e86 Service Worker \u7684 fetch \u8655\u7406\u5668)"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.a,{href:"/docs/api/class-request#request-service-worker",children:"request.serviceWorker()"})," \u5c07\u88ab\u8a2d\u7f6e\u70ba ",(0,n.jsx)(r.code,{children:"null"}),", \u800c ",(0,n.jsx)(r.a,{href:"/docs/api/class-request#request-frame",children:"request.frame()"})," \u5c07\u8fd4\u56de ",(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"})]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.a,{href:"/docs/api/class-response#response-from-service-worker",children:"response.fromServiceWorker()"})," \u5c07\u8fd4\u56de ",(0,n.jsx)(r.code,{children:"true"}),"(\u5982\u679c\u5df2\u8a3b\u518a\u4e86 Service Worker \u7684 fetch \u8655\u7406\u5668)"]}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:"\u8a31\u591a Service Worker \u5be6\u4f5c\u53ea\u662f\u7c21\u55ae\u5730\u57f7\u884c\u4f86\u81ea\u9801\u9762\u7684\u8acb\u6c42\uff08\u53ef\u80fd\u70ba\u4e86\u7c21\u55ae\u8d77\u898b\u7701\u7565\u4e86\u4e00\u4e9b\u81ea\u8a02\u7684\u5feb\u53d6/\u96e2\u7dda\u908f\u8f2f\uff09:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-js",metastring:'title="transparent-service-worker.js"',children:"self.addEventListener('fetch', event => {\n  // actually make the request\n  const responsePromise = fetch(event.request);\n  // send it back to the page\n  event.respondWith(responsePromise);\n});\n\nself.addEventListener('activate', event => {\n  event.waitUntil(clients.claim());\n});\n"})}),"\n",(0,n.jsx)(r.p,{children:"\u5982\u679c\u4e00\u500b\u9801\u9762\u8a3b\u518a\u4e86\u4e0a\u8ff0\u7684 Service Worker:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-html",children:"\x3c!-- filename: index.html --\x3e\n<script>\n  window.registrationPromise = navigator.serviceWorker.register('/transparent-service-worker.js');\n<\/script>\n"})}),"\n",(0,n.jsxs)(r.p,{children:["\u5728\u7b2c\u4e00\u6b21\u901a\u904e ",(0,n.jsx)(r.a,{href:"/docs/api/class-page#page-goto",children:"page.goto()"})," \u8a2a\u554f\u9801\u9762\u6642\uff0c\u5c07\u6703\u767c\u51fa\u4ee5\u4e0b\u8acb\u6c42/\u56de\u61c9\u4e8b\u4ef6\uff08\u4ee5\u53ca\u76f8\u61c9\u7684\u7db2\u8def\u751f\u547d\u9031\u671f\u4e8b\u4ef6\uff09\uff1a"]}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"\u4e8b\u4ef6"}),(0,n.jsx)(r.th,{children:"\u64c1\u6709\u8005"}),(0,n.jsx)(r.th,{children:"URL"}),(0,n.jsx)(r.th,{children:"\u8def\u7531"}),(0,n.jsx)(r.th,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-response#response-from-service-worker",children:"response.fromServiceWorker"})})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request",children:"browserContext.on('request')"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"})}),(0,n.jsx)(r.td,{children:"index.html"}),(0,n.jsx)(r.td,{children:"\u662f"}),(0,n.jsx)(r.td,{})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-page#page-event-request",children:"page.on('request')"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"})}),(0,n.jsx)(r.td,{children:"index.html"}),(0,n.jsx)(r.td,{children:"\u662f"}),(0,n.jsx)(r.td,{})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request",children:"browserContext.on('request')"})}),(0,n.jsxs)(r.td,{children:["Service ",(0,n.jsx)(r.a,{href:"/docs/api/class-worker",title:"Worker",children:"Worker"})]}),(0,n.jsx)(r.td,{children:"transparent-service-worker.js"}),(0,n.jsx)(r.td,{children:"\u662f"}),(0,n.jsx)(r.td,{})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request",children:"browserContext.on('request')"})}),(0,n.jsxs)(r.td,{children:["Service ",(0,n.jsx)(r.a,{href:"/docs/api/class-worker",title:"Worker",children:"Worker"})]}),(0,n.jsx)(r.td,{children:"data.json"}),(0,n.jsx)(r.td,{children:"\u662f"}),(0,n.jsx)(r.td,{})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request",children:"browserContext.on('request')"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"})}),(0,n.jsx)(r.td,{children:"data.json"}),(0,n.jsx)(r.td,{}),(0,n.jsx)(r.td,{children:"\u662f"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-page#page-event-request",children:"page.on('request')"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"})}),(0,n.jsx)(r.td,{children:"data.json"}),(0,n.jsx)(r.td,{}),(0,n.jsx)(r.td,{children:"\u662f"})]})]})]}),"\n",(0,n.jsx)(r.p,{children:'\u7531\u65bc\u7bc4\u4f8b Service Worker \u53ea\u662f\u4f5c\u70ba\u57fa\u672c\u900f\u660e\u7684 "\u4ee3\u7406":'}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["\u6709\u5169\u500b ",(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request",children:"browserContext.on('request')"})," \u4e8b\u4ef6\u91dd\u5c0d ",(0,n.jsx)(r.code,{children:"data.json"}),"; \u4e00\u500b\u662f ",(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"})," \u64c1\u6709\u7684\uff0c\u53e6\u4e00\u500b\u662f Service ",(0,n.jsx)(r.a,{href:"/docs/api/class-worker",title:"Worker",children:"Worker"})," \u64c1\u6709\u7684\u3002"]}),"\n",(0,n.jsxs)(r.li,{children:["\u53ea\u6709 Service ",(0,n.jsx)(r.a,{href:"/docs/api/class-worker",title:"Worker",children:"Worker"})," \u64c1\u6709\u7684\u8cc7\u6e90\u8acb\u6c42\u53ef\u4ee5\u901a\u904e ",(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-route",children:"browserContext.route()"})," \u9032\u884c\u8def\u7531; \u91dd\u5c0d ",(0,n.jsx)(r.code,{children:"data.json"})," \u7684 ",(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"})," \u64c1\u6709\u4e8b\u4ef6\u662f\u7121\u6cd5\u8def\u7531\u7684\uff0c\u56e0\u70ba\u5b83\u5011\u751a\u81f3\u6c92\u6709\u53ef\u80fd\u8a2a\u554f\u5916\u90e8\u7db2\u7d61\uff0c\u56e0\u70ba Service Worker \u5df2\u7d93\u8a3b\u518a\u4e86\u4e00\u500b fetch \u8655\u7406\u5668\u3002"]}),"\n"]}),"\n",(0,n.jsx)(r.admonition,{type:"caution",children:(0,n.jsxs)(r.p,{children:["\u91cd\u8981\u7684\u662f\u8981\u6ce8\u610f: \u547c\u53eb ",(0,n.jsx)(r.a,{href:"/docs/api/class-request#request-frame",children:"request.frame()"})," \u6216 ",(0,n.jsx)(r.a,{href:"/docs/api/class-response#response-frame",children:"response.frame()"})," \u5c07\u6703 ",(0,n.jsx)(r.strong,{children:"\u62cb\u51fa"})," \u4e00\u500b\u4f8b\u5916\uff0c\u5982\u679c\u5728\u4e00\u500b\u5177\u6709\u975e\u7a7a ",(0,n.jsx)(r.a,{href:"/docs/api/class-request#request-service-worker",children:"request.serviceWorker()"})," \u7684 ",(0,n.jsx)(r.a,{href:"/docs/api/class-request",title:"Request",children:"Request"}),"/",(0,n.jsx)(r.a,{href:"/docs/api/class-response",title:"Response",children:"Response"})," \u4e0a\u547c\u53eb\u3002"]})}),"\n",(0,n.jsx)(r.h4,{id:"\u9ad8\u7d1a\u7bc4\u4f8b",children:"\u9ad8\u7d1a\u7bc4\u4f8b"}),"\n",(0,n.jsx)(r.p,{children:"\u7576 Service Worker \u8655\u7406\u9801\u9762\u7684\u8acb\u6c42\u6642\uff0cService Worker \u53ef\u4ee5\u5411\u5916\u90e8\u7db2\u8def\u767c\u51fa 0 \u5230 n \u500b\u8acb\u6c42\u3002Service Worker \u53ef\u80fd\u76f4\u63a5\u5f9e\u5feb\u53d6\u56de\u61c9\u3001\u5728\u8a18\u61b6\u9ad4\u4e2d\u751f\u6210\u56de\u61c9\u3001\u91cd\u5beb\u8acb\u6c42\u3001\u767c\u51fa\u5169\u500b\u8acb\u6c42\u7136\u5f8c\u5408\u4f75\u6210\u4e00\u500b\u7b49\u3002"}),"\n",(0,n.jsx)(r.p,{children:"\u8003\u616e\u4ee5\u4e0b\u7684\u7a0b\u5f0f\u78bc\u7247\u6bb5\u4f86\u4e86\u89e3 Playwright \u5c0d Request/Responses \u7684\u770b\u6cd5\uff0c\u4ee5\u53ca\u5b83\u5982\u4f55\u5f71\u97ff\u9019\u4e9b\u60c5\u6cc1\u4e0b\u7684\u8def\u7531\u3002"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-js",metastring:'title="complex-service-worker.js"',children:"self.addEventListener('install', function(event) {\n  event.waitUntil(\n      caches.open('v1').then(function(cache) {\n      // 1. Pre-fetches and caches /addressbook.json\n        return cache.add('/addressbook.json');\n      })\n  );\n});\n\n// Opt to handle FetchEvent's from the page\nself.addEventListener('fetch', event => {\n  event.respondWith(\n      (async () => {\n        // 1. Try to first serve directly from caches\n        const response = await caches.match(event.request);\n        if (response)\n          return response;\n\n        // 2. Re-write request for /foo to /bar\n        if (event.request.url.endsWith('foo'))\n          return fetch('./bar');\n\n        // 3. Prevent tracker.js from being retrieved, and returns a placeholder response\n        if (event.request.url.endsWith('tracker.js')) {\n          return new Response('console.log(\"no trackers!\")', {\n            status: 200,\n            headers: { 'Content-Type': 'text/javascript' },\n          });\n        }\n\n        // 4. Otherwise, fallthrough, perform the fetch and respond\n        return fetch(event.request);\n      })()\n  );\n});\n\nself.addEventListener('activate', event => {\n  event.waitUntil(clients.claim());\n});\n"})}),"\n",(0,n.jsx)(r.p,{children:"\u800c\u4e14\u4e00\u500b\u7c21\u55ae\u8a3b\u518a Service Worker \u7684\u9801\u9762:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-html",children:"\x3c!-- filename: index.html --\x3e\n<script>\n  window.registrationPromise = navigator.serviceWorker.register('/complex-service-worker.js');\n<\/script>\n"})}),"\n",(0,n.jsxs)(r.p,{children:["\u5728\u7b2c\u4e00\u6b21\u901a\u904e ",(0,n.jsx)(r.a,{href:"/docs/api/class-page#page-goto",children:"page.goto()"})," \u8a2a\u554f\u9801\u9762\u6642\uff0c\u5c07\u6703\u767c\u51fa\u4ee5\u4e0b\u7684\u8acb\u6c42/\u56de\u61c9\u4e8b\u4ef6\uff1a"]}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"\u4e8b\u4ef6"}),(0,n.jsx)(r.th,{children:"\u64c1\u6709\u8005"}),(0,n.jsx)(r.th,{children:"URL"}),(0,n.jsx)(r.th,{children:"\u8def\u7531"}),(0,n.jsx)(r.th,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-response#response-from-service-worker",children:"response.fromServiceWorker"})})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request",children:"browserContext.on('request')"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"})}),(0,n.jsx)(r.td,{children:"index.html"}),(0,n.jsx)(r.td,{children:"\u662f"}),(0,n.jsx)(r.td,{})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-page#page-event-request",children:"page.on('request')"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"})}),(0,n.jsx)(r.td,{children:"index.html"}),(0,n.jsx)(r.td,{children:"\u662f"}),(0,n.jsx)(r.td,{})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request",children:"browserContext.on('request')"})}),(0,n.jsxs)(r.td,{children:["Service ",(0,n.jsx)(r.a,{href:"/docs/api/class-worker",title:"Worker",children:"Worker"})]}),(0,n.jsx)(r.td,{children:"complex-service-worker.js"}),(0,n.jsx)(r.td,{children:"\u662f"}),(0,n.jsx)(r.td,{})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request",children:"browserContext.on('request')"})}),(0,n.jsxs)(r.td,{children:["Service ",(0,n.jsx)(r.a,{href:"/docs/api/class-worker",title:"Worker",children:"Worker"})]}),(0,n.jsx)(r.td,{children:"addressbook.json"}),(0,n.jsx)(r.td,{children:"\u662f"}),(0,n.jsx)(r.td,{})]})]})]}),"\n",(0,n.jsxs)(r.p,{children:["\u9700\u8981\u6ce8\u610f\u7684\u662f ",(0,n.jsx)(r.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Cache/add",children:(0,n.jsx)(r.code,{children:"cache.add"})})," \u4f7f\u5f97 Service Worker \u767c\u51fa\u8acb\u6c42(Service ",(0,n.jsx)(r.a,{href:"/docs/api/class-worker",title:"Worker",children:"Worker"}),"-owned)\uff0c\u5373\u4f7f\u5728\u9801\u9762\u4e2d\u8acb\u6c42 ",(0,n.jsx)(r.code,{children:"addressbook.json"})," \u4e4b\u524d\u3002"]}),"\n",(0,n.jsx)(r.p,{children:"\u4e00\u65e6 Service Worker \u88ab\u555f\u7528\u4e26\u8655\u7406 FetchEvents\uff0c\u5982\u679c\u9801\u9762\u767c\u51fa\u4ee5\u4e0b\u8acb\u6c42:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-js",children:"await page.evaluate(() => fetch('/addressbook.json'));\nawait page.evaluate(() => fetch('/foo'));\nawait page.evaluate(() => fetch('/tracker.js'));\nawait page.evaluate(() => fetch('/fallthrough.txt'));\n"})}),"\n",(0,n.jsx)(r.p,{children:"\u4ee5\u4e0b\u7684\u8acb\u6c42/\u56de\u61c9\u4e8b\u4ef6\u5c07\u6703\u88ab\u89f8\u767c:"}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Event"}),(0,n.jsx)(r.th,{children:"Owner"}),(0,n.jsx)(r.th,{children:"URL"}),(0,n.jsx)(r.th,{children:"Routed"}),(0,n.jsx)(r.th,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-response#response-from-service-worker",children:"response.fromServiceWorker"})})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request",children:"browserContext.on('request')"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"})}),(0,n.jsx)(r.td,{children:"addressbook.json"}),(0,n.jsx)(r.td,{}),(0,n.jsx)(r.td,{children:"Yes"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-page#page-event-request",children:"page.on('request')"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"})}),(0,n.jsx)(r.td,{children:"addressbook.json"}),(0,n.jsx)(r.td,{}),(0,n.jsx)(r.td,{children:"Yes"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request",children:"browserContext.on('request')"})}),(0,n.jsxs)(r.td,{children:["Service ",(0,n.jsx)(r.a,{href:"/docs/api/class-worker",title:"Worker",children:"Worker"})]}),(0,n.jsx)(r.td,{children:"bar"}),(0,n.jsx)(r.td,{children:"Yes"}),(0,n.jsx)(r.td,{})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request",children:"browserContext.on('request')"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"})}),(0,n.jsx)(r.td,{children:"foo"}),(0,n.jsx)(r.td,{}),(0,n.jsx)(r.td,{children:"Yes"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-page#page-event-request",children:"page.on('request')"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"})}),(0,n.jsx)(r.td,{children:"foo"}),(0,n.jsx)(r.td,{}),(0,n.jsx)(r.td,{children:"Yes"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request",children:"browserContext.on('request')"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"})}),(0,n.jsx)(r.td,{children:"tracker.js"}),(0,n.jsx)(r.td,{}),(0,n.jsx)(r.td,{children:"Yes"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-page#page-event-request",children:"page.on('request')"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"})}),(0,n.jsx)(r.td,{children:"tracker.js"}),(0,n.jsx)(r.td,{}),(0,n.jsx)(r.td,{children:"Yes"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request",children:"browserContext.on('request')"})}),(0,n.jsxs)(r.td,{children:["Service ",(0,n.jsx)(r.a,{href:"/docs/api/class-worker",title:"Worker",children:"Worker"})]}),(0,n.jsx)(r.td,{children:"fallthrough.txt"}),(0,n.jsx)(r.td,{children:"Yes"}),(0,n.jsx)(r.td,{})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-browsercontext#browser-context-event-request",children:"browserContext.on('request')"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"})}),(0,n.jsx)(r.td,{children:"fallthrough.txt"}),(0,n.jsx)(r.td,{}),(0,n.jsx)(r.td,{children:"Yes"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-page#page-event-request",children:"page.on('request')"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"})}),(0,n.jsx)(r.td,{children:"fallthrough.txt"}),(0,n.jsx)(r.td,{}),(0,n.jsx)(r.td,{children:"Yes"})]})]})]}),"\n",(0,n.jsx)(r.p,{children:"\u8acb\u6ce8\u610f:"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["\u8a72\u9801\u9762\u8acb\u6c42\u4e86 ",(0,n.jsx)(r.code,{children:"/foo"}),", \u4f46\u670d\u52d9\u5de5\u4f5c\u8005\u8acb\u6c42\u4e86 ",(0,n.jsx)(r.code,{children:"/bar"}),", \u56e0\u6b64\u53ea\u6709 ",(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"}),"-\u64c1\u6709\u7684\u4e8b\u4ef6\u662f\u91dd\u5c0d ",(0,n.jsx)(r.code,{children:"/foo"}),", \u800c\u4e0d\u662f ",(0,n.jsx)(r.code,{children:"/bar"}),"\u3002"]}),"\n",(0,n.jsxs)(r.li,{children:["\u540c\u6a23\u5730, \u670d\u52d9\u5de5\u4f5c\u8005\u5f9e\u672a\u8a2a\u554f\u904e ",(0,n.jsx)(r.code,{children:"tracker.js"})," \u7684\u7db2\u7d61, \u56e0\u6b64\u53ea\u6709 ",(0,n.jsx)(r.a,{href:"/docs/api/class-frame",title:"Frame",children:"Frame"}),"-\u64c1\u6709\u7684\u4e8b\u4ef6\u662f\u91dd\u5c0d\u8a72\u8acb\u6c42\u767c\u51fa\u7684\u3002"]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"\u50c5\u8def\u7531\u670d\u52d9\u5de5\u4f5c\u8005\u8acb\u6c42",children:"\u50c5\u8def\u7531\u670d\u52d9\u5de5\u4f5c\u8005\u8acb\u6c42"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-js",children:"await context.route('**', async route => {\n  if (route.request().serviceWorker()) {\n    // NB: calling route.request().frame() here would THROW\n    return route.fulfill({\n      contentType: 'text/plain',\n      status: 200,\n      body: 'from sw',\n    });\n  } else {\n    return route.continue();\n  }\n});\n"})}),"\n",(0,n.jsx)(r.h2,{id:"\u5df2\u77e5\u9650\u5236",children:"\u5df2\u77e5\u9650\u5236"}),"\n",(0,n.jsxs)(r.p,{children:["\u76ee\u524d\u7121\u6cd5\u8def\u7531\u66f4\u65b0\u7684 Service Worker \u4e3b\u8173\u672c\u7a0b\u5f0f\u78bc\u7684\u8acb\u6c42 (",(0,n.jsx)(r.a,{href:"https://github.com/microsoft/playwright/issues/14711)%E3%80%82",children:"https://github.com/microsoft/playwright/issues/14711)\u3002"})]})]})}function h(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}}}]);